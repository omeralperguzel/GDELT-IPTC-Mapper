<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDELT Theme â†’ IPTC Media Topics Mapping Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .config-panel {
            background: #e8eaf6;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .config-group {
            display: flex;
            flex-direction: column;
        }
        
        .config-group label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .config-group input,
        .config-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .config-buttons {
            display: flex;
            gap: 10px;
        }
        
        .run-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .run-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-message {
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .methodology {
            font-size: 0.95em;
            opacity: 0.85;
            margin-top: 10px;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .stat-card h3 {
            color: #667eea;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .search-box {
            flex: 1;
            min-width: 200px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .filter-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .method-tabs {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }
        
        .method-tab {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .method-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .charts-section {
            padding: 30px;
            background: #f8f9fa;
        }
        
        #tab-charts .charts-section {
            padding: 20px;
            background: transparent;
        }
        
        .method-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #e8eaf6;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .info-box h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .info-box p {
            font-size: 0.9em;
            color: #555;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .formula-container {
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid #d0d0e8;
        }
        
        .formula-title {
            font-size: 0.85em;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .katex {
            font-size: 1.1em;
        }
        
        .parameters-list {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #d0d0e8;
            margin-top: 10px;
        }
        
        .parameters-list h5 {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .param-item {
            font-size: 0.85em;
            color: #555;
            line-height: 1.6;
            margin-bottom: 6px;
            padding-left: 10px;
            border-left: 2px solid #667eea;
        }
        
        .param-item strong {
            color: #667eea;
        }
        
        .country-detail-view {
            display: none;
        }
        
        .country-detail-view.active {
            display: block;
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }
        
        .detail-header h3 {
            color: #667eea;
            font-size: 1.5em;
            margin: 0;
        }
        
        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .back-button:hover {
            background: #5a6268;
        }
        
        .calculation-section {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .calculation-section h4 {
            color: #667eea;
            margin-top: 0;
            font-size: 1.05em;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .data-table th, .data-table td {
            padding: 8px;
            text-align: right;
            border: 1px solid #ddd;
        }
        
        .data-table th {
            background: #f0f0f5;
            color: #667eea;
            font-weight: 600;
        }
        
        .data-table tr:hover {
            background: #f9f9fc;
        }
        
        .calculation-steps {
            background: #f9f9fc;
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .calculation-step {
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-left: 3px solid #667eea;
            padding-left: 12px;
        }
        
        .formula-result {
            background: #e8eaf6;
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 600;
            color: #667eea;
            text-align: center;
            font-size: 1.1em;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-container h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        
        th:hover {
            background: rgba(255,255,255,0.1);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .positive {
            color: #27ae60;
            font-weight: bold;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .significant {
            background: #ecf0f1;
            font-weight: 500;
        }
        
        .table-wrapper {
            padding: 30px;
            overflow-x: auto;
        }
        
        .legend {
            padding: 20px;
            background: #f8f9fa;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 0.95em;
        }
        
        .legend p {
            margin-bottom: 8px;
        }
        
        /* TAB STYLING */
        .tabs-container {
            display: flex;
            gap: 5px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s;
            color: #666;
        }
        
        .tab-button:hover {
            background: #f0f0f0;
            border-color: #667eea;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .tab-content {
            display: none;
            width: 100%;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ GDELT Theme â†’ IPTC Media Topics Mapping</h1>
            <p>Semantic Embedding Analysis with Sentence-Transformers (all-MiniLM-L6-v2)</p>
            <p class="methodology">Cosine Similarity â€¢ IPTC NewsCodes (17 Categories) â€¢ Supervised Mapping</p>
        </header>
        
        <div class="config-panel">
            <h3 style="color: #0f3460; margin-bottom: 15px;">âš™ï¸ GDELT & IPTC Analiz Parametreleri</h3>
            <div class="config-grid">
                <div class="config-group">
                    <label for="min-docs-threshold">Min. DokÃ¼man EÅŸiÄŸi:</label>
                    <input type="number" id="min-docs-threshold" min="0" max="100000" value="1000" title="Minimum toplam dokÃ¼man sayÄ±sÄ± filtresi">
                </div>
                <div class="config-group">
                    <label for="quality-threshold">Min. Kalite OranÄ± (%):</label>
                    <input type="number" id="quality-threshold" min="0" max="100" value="50" title="Minimum aylÄ±k kalite oranÄ±">
                </div>
                <div class="config-group">
                    <label for="similarity-threshold">Min. Benzerlik Skoru:</label>
                    <input type="number" id="similarity-threshold" min="0" max="1" step="0.01" value="0.30" title="IPTC eÅŸleÅŸtirme minimum benzerlik">
                </div>
                <div class="config-group">
                    <label for="iptc-filter-param">IPTC Kategori Filtresi:</label>
                    <select id="iptc-filter-param">
                        <option value="all">TÃ¼m Kategoriler (17)</option>
                        <option value="economy, business and finance">ğŸ’° Economy</option>
                        <option value="conflict, war and peace">âš”ï¸ Conflict</option>
                        <option value="politics and government">ğŸ›ï¸ Politics</option>
                        <option value="health">ğŸ¥ Health</option>
                        <option value="education">ğŸ“š Education</option>
                        <option value="disaster, accident and emergency incident">ğŸš¨ Disaster</option>
                        <option value="environment">ğŸŒ Environment</option>
                    </select>
                </div>
            </div>
            <div class="config-buttons">
                <button class="run-btn" id="run-analysis-btn" onclick="applyGDELTFilters()">ğŸ” Filtreleri Uygula</button>
                <button class="run-btn" style="background: #6c757d;" id="reset-btn" onclick="resetGDELTFilters()">ğŸ”„ SÄ±fÄ±rla</button>
                <span style="margin: 0 10px; color: #999;">|</span>
                <button class="run-btn" style="background: #28a745;" id="save-btn" title="Mevcut analizi kaydet" onclick="saveGDELTAnalysis()">ğŸ’¾ Kaydet</button>
                <button class="run-btn" style="background: #17a2b8;" id="import-btn" title="Dosyadan iÃ§e aktar" onclick="triggerImport()">ğŸ“¥ Ä°Ã§e Aktar</button>
                <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="handleGDELTImportFile(event)">
            </div>
            <div class="status-message" id="status-message"></div>
        </div>
        
        <!-- TAB BUTTONS -->
        <div class="tabs-container">
            <button class="tab-button active" data-tab="gdelt">ğŸ“° GDELT Tema</button>
            <button class="tab-button" data-tab="charts">ğŸ“ˆ Grafikler</button>
            <button class="tab-button" data-tab="clustering">ğŸ¤– KÃ¼meleme</button>
            <button class="tab-button" data-tab="export">ğŸ“¤ DÄ±ÅŸarÄ± Aktar</button>
        </div>
        
        <!-- TAB 2: CHARTS - GDELT/IPTC Grafikleri -->
        <div class="tab-content" id="tab-charts">
            <div class="charts-section">
                <h3 style="color: #0f3460; margin-bottom: 20px; text-align: center;">ğŸ“ˆ GDELT Tema & IPTC Kategori Grafikleri</h3>
                <p style="text-align: center; color: #666; margin-bottom: 25px;">
                    GDELT tema daÄŸÄ±lÄ±mlarÄ± ve IPTC kategori bazlÄ± gÃ¶rselleÅŸtirmeler
                </p>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>ğŸ“Š IPTC Kategori DaÄŸÄ±lÄ±mÄ±</h3>
                        <div class="chart-wrapper">
                            <canvas id="iptc-distribution-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸŒ Ãœlke BazlÄ± Tema Hacmi</h3>
                        <div class="chart-wrapper">
                            <canvas id="country-theme-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸ“ˆ En YÃ¼ksek Hacimli Temalar</h3>
                        <div class="chart-wrapper">
                            <canvas id="top-themes-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸ¯ IPTC Benzerlik SkorlarÄ±</h3>
                        <div class="chart-wrapper">
                            <canvas id="iptc-similarity-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- KÃ¼meleme Grafikleri BÃ¶lÃ¼mÃ¼ -->
                <h3 style="color: #667eea; margin: 40px 0 20px; text-align: center;">ğŸ¤– KÃ¼meleme SonuÃ§ Grafikleri</h3>
                <p style="text-align: center; color: #666; margin-bottom: 25px;">
                    Her iki algoritmanÄ±n t-SNE sonuÃ§larÄ±nÄ± karÅŸÄ±laÅŸtÄ±rÄ±n
                </p>
                
                <!-- t-SNE KarÅŸÄ±laÅŸtÄ±rma BÃ¶lÃ¼mÃ¼ -->
                <div style="background: #f0f4f8; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
                    <h4 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸ¯ t-SNE 2D Tema DaÄŸÄ±lÄ±mÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="chart-container" style="margin: 0;">
                            <h3 style="color: #667eea;">V1: Sadece Embedding</h3>
                            <div class="chart-wrapper">
                                <canvas id="tsne-scatter-chart-v1"></canvas>
                            </div>
                            <div id="tsne-v1-info" style="text-align: center; font-size: 0.8em; color: #666; margin-top: 5px;">V1 sonuÃ§larÄ±nÄ± yÃ¼kleyin</div>
                        </div>
                        <div class="chart-container" style="margin: 0;">
                            <h3 style="color: #FF9800;">V2: Ä°ki KatmanlÄ± Fusion</h3>
                            <div class="chart-wrapper">
                                <canvas id="tsne-scatter-chart-v2"></canvas>
                            </div>
                            <div id="tsne-v2-info" style="text-align: center; font-size: 0.8em; color: #666; margin-top: 5px;">V2 sonuÃ§larÄ±nÄ± yÃ¼kleyin</div>
                        </div>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>ğŸ“Š IPTC Kategori Tema SayÄ±sÄ±</h3>
                        <div class="chart-wrapper">
                            <canvas id="iptc-theme-count-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸ”¥ Benzerlik Skor DaÄŸÄ±lÄ±mÄ±</h3>
                        <div class="chart-wrapper">
                            <canvas id="similarity-histogram-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸ·ï¸ EÅŸleÅŸtirme YÃ¶ntemi DaÄŸÄ±lÄ±mÄ±</h3>
                        <div class="chart-wrapper">
                            <canvas id="method-pie-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Grafik OluÅŸtur Butonu -->
                <div style="text-align: center; margin-top: 20px;">
                    <button class="run-btn" onclick="generateGDELTCharts()">ğŸ”„ GDELT Grafikleri OluÅŸtur</button>
                    <button class="run-btn" style="background: #667eea; margin-left: 10px;" onclick="generateClusteringCharts()">ğŸ¤– KÃ¼meleme Grafikleri OluÅŸtur</button>
                    <p style="font-size: 0.85em; color: #888; margin-top: 10px;">
                        Not: GDELT grafikleri iÃ§in CSV yÃ¼kleyin, KÃ¼meleme grafikleri iÃ§in KÃ¼meleme sekmesinden eÅŸleÅŸtirme Ã§alÄ±ÅŸtÄ±rÄ±n
                    </p>
                </div>
            </div>
        </div>
        
        <!-- TAB 3: CLUSTERING -->
        <div class="tab-content" id="tab-clustering">
            <!-- GDELT Theme â†’ IPTC Media Topics Mapping -->
            <div class="charts-section" style="text-align: center; padding: 20px;">
                <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ¯ GDELT Tema â†’ IPTC Media Topics EÅŸleÅŸtirme</h3>
                <p style="text-align: center; color: #666; margin-bottom: 15px;">
                    Sentence-Transformer embedding + Cosine Similarity â†’ IPTC NewsCodes (17 Ã¼st dÃ¼zey kategori)
                </p>
                <p style="text-align: center; color: #888; font-size: 0.85em; margin-bottom: 20px;">
                    <em>Referans: Kuzman & LjubeÅ¡iÄ‡ (2024), Vargo & Guo (2017), Tarekegn (2024)</em>
                </p>
                
                <!-- Algoritma SeÃ§imi -->
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; max-width: 800px; margin: 0 auto 25px;">
                    <h4 style="color: #333; margin-bottom: 15px;">Algoritma SeÃ§imi ve Ã‡alÄ±ÅŸtÄ±rma</h4>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 15px; border: 2px solid #667eea; border-radius: 8px; background: white; min-width: 280px;">
                            <div style="text-align: center;">
                                <strong style="color: #667eea; font-size: 1.1em;">V1: Sadece Embedding</strong>
                                <div style="font-size: 0.8em; color: #666; margin-top: 5px;">Cosine similarity NN mapping</div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="run-btn" style="background: #667eea; padding: 8px 16px; font-size: 0.9em;" onclick="runIPTCMappingV1()">ğŸš€ V1 Ã‡alÄ±ÅŸtÄ±r</button>
                                <button class="run-btn" style="background: #4CAF50; padding: 8px 16px; font-size: 0.9em;" onclick="loadIPTCMappingResultsV1()">ğŸ“¥ V1 YÃ¼kle</button>
                            </div>
                            <div id="v1-status" style="font-size: 0.8em; color: #999;">YÃ¼klenmedi</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 15px; border: 2px solid #FF9800; border-radius: 8px; background: white; min-width: 280px;">
                            <div style="text-align: center;">
                                <strong style="color: #FF9800; font-size: 1.1em;">V2: Ä°ki KatmanlÄ± Fusion</strong>
                                <div style="font-size: 0.8em; color: #666; margin-top: 5px;">Kural tabanlÄ± + Embedding NN (Ã–nerilen)</div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="run-btn" style="background: #FF9800; padding: 8px 16px; font-size: 0.9em;" onclick="runIPTCMappingV2()">ğŸš€ V2 Ã‡alÄ±ÅŸtÄ±r</button>
                                <button class="run-btn" style="background: #4CAF50; padding: 8px 16px; font-size: 0.9em;" onclick="loadIPTCMappingResultsV2()">ğŸ“¥ V2 YÃ¼kle</button>
                            </div>
                            <div id="v2-status" style="font-size: 0.8em; color: #999;">YÃ¼klenmedi</div>
                        </div>
                    </div>
                    
                    <!-- Aktif Algoritma SeÃ§imi -->
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px;">
                        <label style="font-weight: 600; color: #2e7d32; margin-right: 15px;">ğŸ“Š GDELT Tema ve Grafikler iÃ§in Aktif SonuÃ§:</label>
                        <select id="active-mapping-select" onchange="switchActiveMapping()" style="padding: 10px 15px; border-radius: 5px; border: 2px solid #4CAF50; font-size: 1em; font-weight: 600;">
                            <option value="v2">V2 - Ä°ki KatmanlÄ± Fusion</option>
                            <option value="v1">V1 - Sadece Embedding</option>
                        </select>
                        <span id="active-mapping-info" style="margin-left: 15px; color: #666; font-size: 0.9em;">V2 sonuÃ§larÄ± kullanÄ±lÄ±yor</span>
                    </div>
                </div>
                
                <!-- Progress Gostergesi -->
                <div id="iptc-progress-container" style="display: none; max-width: 600px; margin: 0 auto 25px; background: #f0f4f8; border-radius: 10px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div class="loading-spinner" style="width: 24px; height: 24px;"></div>
                        <span id="iptc-progress-text" style="font-weight: 600; color: #333;">Baslatiliyor...</span>
                    </div>
                    <div style="background: #e0e0e0; border-radius: 5px; height: 8px; overflow: hidden;">
                        <div id="iptc-progress-bar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <div id="iptc-progress-steps" style="margin-top: 15px; text-align: left; font-size: 0.85em;">
                        <div class="progress-step" data-step="1" style="padding: 8px 0; color: #666; display: flex; align-items: center; gap: 10px;">
                            <span class="step-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: #6b7280; color: white; font-size: 12px; font-weight: bold;">1</span>
                            <span class="step-text">Katman 1: Kural tabanli mapping (prefix + Vargo)</span>
                        </div>
                        <div class="progress-step" data-step="2" style="padding: 8px 0; color: #666; display: flex; align-items: center; gap: 10px;">
                            <span class="step-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: #6b7280; color: white; font-size: 12px; font-weight: bold;">2</span>
                            <span class="step-text">Katman 2: Sentence-BERT embedding hesaplama</span>
                        </div>
                        <div class="progress-step" data-step="3" style="padding: 8px 0; color: #666; display: flex; align-items: center; gap: 10px;">
                            <span class="step-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: #6b7280; color: white; font-size: 12px; font-weight: bold;">3</span>
                            <span class="step-text">Cosine similarity NN atama</span>
                        </div>
                        <div class="progress-step" data-step="4" style="padding: 8px 0; color: #666; display: flex; align-items: center; gap: 10px;">
                            <span class="step-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: #6b7280; color: white; font-size: 12px; font-weight: bold;">4</span>
                            <span class="step-text">Fusion: Kural + Embedding birlestirme</span>
                        </div>
                        <div class="progress-step" data-step="5" style="padding: 8px 0; color: #666; display: flex; align-items: center; gap: 10px;">
                            <span class="step-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: #6b7280; color: white; font-size: 12px; font-weight: bold;">5</span>
                            <span class="step-text">t-SNE 2D koordinat hesaplama</span>
                        </div>
                        <div class="progress-step" data-step="6" style="padding: 8px 0; color: #666; display: flex; align-items: center; gap: 10px;">
                            <span class="step-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: #6b7280; color: white; font-size: 12px; font-weight: bold;">6</span>
                            <span class="step-text">Sonuclari kaydetme</span>
                        </div>
                    </div>
                </div>
                
                <div id="iptc-mapping-status" class="status-message" style="max-width: 800px; margin: 0 auto 20px;"></div>
                
                <!-- IPTC Kategori KartlarÄ± Grid -->
                <div id="iptc-categories-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 25px auto; max-width: 1000px;">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
                
                <!-- Tema-IPTC EÅŸleÅŸtirme Tablosu -->
                <div class="chart-container" style="margin-top: 25px; max-width: 900px; margin-left: auto; margin-right: auto;">
                    <h4 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š TÃ¼m Temalar ve IPTC EÅŸleÅŸtirmeleri</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table id="iptc-themes-table" style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                            <thead style="position: sticky; top: 0; background: #e3f2fd;">
                                <tr>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #2196F3;">Tema Kodu</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #2196F3;">IPTC Kategori</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #2196F3;">Benzerlik</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #2196F3;">GÃ¼ven</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #2196F3;">2. En YakÄ±n</th>
                                </tr>
                            </thead>
                            <tbody id="iptc-themes-tbody">
                                <tr><td colspan="5" style="text-align: center; padding: 30px; color: #999;">IPTC eÅŸleÅŸtirme sonuÃ§larÄ± yÃ¼klenmedi</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB 1: GDELT TEMA ANALÄ°ZÄ° -->
        <div class="tab-content active" id="tab-gdelt">
            <div class="charts-section">
                <h3 style="color: #0f3460; margin-bottom: 20px; text-align: center;">ğŸ“° GDELT Tema â†’ IPTC Media Topics Analizi</h3>
                <p style="text-align: center; color: #666; margin-bottom: 25px;">
                    GDELT GKG temalarÄ±nÄ±n IPTC NewsCodes (17 Ã¼st dÃ¼zey kategori) ile semantic eÅŸleÅŸtirmesi
                </p>
                
                <!-- Kontrol Paneli -->
                <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; justify-content: center;">
                    <button class="run-btn" id="load-gdelt-data-btn" onclick="loadGDELTData()">ğŸ“¥ CSV Verilerini YÃ¼kle</button>
                    <button class="run-btn" style="background: #4CAF50;" id="analyze-themes-btn" onclick="analyzeThemes()" disabled>ğŸ” Tema Analizi Yap</button>
                    <button class="run-btn" style="background: #FF9800;" id="generate-matrix-btn" onclick="generateCountryThemeMatrix()" disabled>ğŸ“Š Matris OluÅŸtur</button>
                </div>
                
                <div id="gdelt-status" class="status-message" style="max-width: 600px; margin: 0 auto 20px;"></div>
                
                <!-- Ana Ä°Ã§erik Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    
                    <!-- SOL PANEL: Tablo-1 (total_docs) -->
                    <div class="chart-container" style="border-left: 4px solid #2196F3;">
                        <h4 style="color: #2196F3; margin-bottom: 10px;">ğŸ“‹ Tablo-1: Ãœlke BaÅŸÄ±na Top 15 Tema (BigQuery: QUALIFY ROW_NUMBER() <= 15)</h4>
                        <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                            Her Ã¼lke-tema iÃ§in 2022-2024 toplam dokÃ¼man sayÄ±sÄ±
                        </p>
                        
                        <!-- Ãœlke SeÃ§imi -->
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: 600; font-size: 0.9em;">Ãœlke SeÃ§:</label>
                            <select id="gdelt-country-select" onchange="updateTotalDocsTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 10px;">
                                <option value="ALL">ğŸŒ TÃ¼m Ãœlkeler</option>
                                <option value="CE">CE - Sri Lanka</option>
                                <option value="HO">HO - Honduras</option>
                                <option value="HR">HR - Croatia</option>
                                <option value="KG">KG - Kyrgyzstan</option>
                                <option value="LO">LO - Slovakia</option>
                                <option value="SA">SA - Saudi Arabia</option>
                            </select>
                        </div>
                        
                        <!-- Tablo -->
                        <div style="max-height: 450px; overflow-y: auto;">
                            <table id="total-docs-table" style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                                <thead style="position: sticky; top: 0; background: #e3f2fd;">
                                    <tr>
                                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #2196F3;">Ãœlke</th>
                                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #2196F3;">Tema Kodu</th>
                                        <th style="padding: 10px; text-align: right; border-bottom: 2px solid #2196F3;">Toplam DokÃ¼man</th>
                                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #2196F3;">IPTC Kategorisi</th>
                                    </tr>
                                </thead>
                                <tbody id="total-docs-tbody">
                                    <tr><td colspan="4" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi. YukarÄ±daki butona tÄ±klayÄ±n.</td></tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- AÃ§Ä±klama -->
                        <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 5px; font-size: 0.85em;">
                            <strong>ğŸ¯ IPTC Media Topics (17 Kategori):</strong><br>
                            ğŸ’° <span style="color: #FF9800;">Economy</span>: ECON, EPU, EPU_ECONOMY |
                            âš”ï¸ <span style="color: #F44336;">Conflict</span>: CRISISLEX, ARMEDCONFLICT |
                            ğŸ›ï¸ <span style="color: #2196F3;">Politics</span>: LEADER, GOV, ELECTION<br>
                            ğŸ¥ <span style="color: #4CAF50;">Health</span>: HEALTH, MEDICAL |
                            ğŸ“š <span style="color: #9C27B0;">Education</span>: EDUCATION |
                            âœˆï¸ <span style="color: #00BCD4;">Lifestyle</span>: TOURISM
                        </div>
                    </div>
                    
                    <!-- SAÄ PANEL: Tablo-2 (months_ok, median_docs) -->
                    <div class="chart-container" style="border-left: 4px solid #4CAF50;">
                        <h4 style="color: #4CAF50; margin-bottom: 10px;">ğŸ“‹ Tablo-2: AylÄ±k Kalite Metrikleri (BigQuery: months_total, months_ok, median_docs)</h4>
                        <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                            Her Ã¼lke-tema iÃ§in aylÄ±k haber yeterliliÄŸi
                        </p>
                        
                        <!-- Filtre -->
                        <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <label style="font-weight: 600; font-size: 0.9em;">Kalite Filtresi:</label>
                            <select id="gdelt-quality-filter" onchange="updateMonthlyQualityTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd;">
                                <option value="all">TÃ¼mÃ¼</option>
                                <option value="good">âœ… Ä°yi (â‰¥70%)</option>
                                <option value="marginal">âš ï¸ SÄ±nÄ±rda (40-70%)</option>
                                <option value="poor">âŒ Yetersiz (<40%)</option>
                            </select>
                        </div>
                        
                        <!-- Tablo -->
                        <div style="max-height: 450px; overflow-y: auto;">
                            <table id="monthly-quality-table" style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                                <thead style="position: sticky; top: 0; background: #e8f5e9;">
                                    <tr>
                                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #4CAF50;">Ãœlke</th>
                                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #4CAF50;">Tema</th>
                                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #4CAF50;">IPTC Kategorisi</th>
                                        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #4CAF50;">Ay</th>
                                        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #4CAF50;">Oran</th>
                                        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #4CAF50;">Karar</th>
                                    </tr>
                                </thead>
                                <tbody id="monthly-quality-tbody">
                                    <tr><td colspan="6" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi. YukarÄ±daki butona tÄ±klayÄ±n.</td></tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Karar KurallarÄ± -->
                        <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 5px; font-size: 0.85em;">
                            <strong>ğŸ“Œ Karar KurallarÄ± (AylÄ±k Sentiment iÃ§in):</strong><br>
                            âœ… <span style="color: #4CAF50;">months_ok/total â‰¥ 0.7</span> â†’ Kullan (aylÄ±k)<br>
                            âš ï¸ <span style="color: #FF9800;">0.4 â€“ 0.7</span> â†’ Quarterly aggregation<br>
                            âŒ <span style="color: #f44336;">< 0.4</span> â†’ O kategoriyi Ã§Ä±kar
                        </div>
                    </div>
                </div>
                
                <!-- TABLO-3: AylÄ±k Detay (Tam GeniÅŸlik) -->
                <div class="chart-container" style="margin-top: 25px; border-left: 4px solid #FF5722;">
                    <h4 style="color: #FF5722; margin-bottom: 10px;">ğŸ“‹ Tablo-3: AylÄ±k Tema BaÅŸÄ±na Belge SayÄ±larÄ± (BigQuery: ym, country, theme_code, n_docs)</h4>
                    <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                        Her ay, her Ã¼lke, her tema iÃ§in dokÃ¼man sayÄ±sÄ± - zaman serisi analizi iÃ§in
                    </p>
                    
                    <!-- Filtreler -->
                    <div style="margin-bottom: 15px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">Ãœlke:</label>
                            <select id="monthly-detail-country" onchange="updateMonthlyDetailTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px;">
                                <option value="ALL">ğŸŒ TÃ¼mÃ¼</option>
                                <option value="CE">CE - Sri Lanka</option>
                                <option value="HO">HO - Honduras</option>
                                <option value="HR">HR - Croatia</option>
                                <option value="KG">KG - Kyrgyzstan</option>
                                <option value="LO">LO - Slovakia</option>
                                <option value="SA">SA - Saudi Arabia</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">Tema:</label>
                            <select id="monthly-detail-theme" onchange="updateMonthlyDetailTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px;">
                                <option value="ALL">TÃ¼mÃ¼</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">YÄ±l:</label>
                            <select id="monthly-detail-year" onchange="updateMonthlyDetailTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px;">
                                <option value="ALL">TÃ¼mÃ¼</option>
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">Min DokÃ¼man:</label>
                            <input type="number" id="monthly-detail-min-docs" value="100" min="0" onchange="updateMonthlyDetailTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px; width: 80px;">
                        </div>
                        <span id="monthly-detail-count" style="color: #666; font-size: 0.9em;"></span>
                    </div>
                    
                    <!-- Tablo -->
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table id="monthly-detail-table" style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                            <thead style="position: sticky; top: 0; background: #fbe9e7;">
                                <tr>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #FF5722; cursor: pointer;" onclick="sortMonthlyDetailTable('ym')">ğŸ“… Ay-YÄ±l â‡…</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #FF5722; cursor: pointer;" onclick="sortMonthlyDetailTable('country')">ğŸŒ Ãœlke â‡…</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #FF5722; cursor: pointer;" onclick="sortMonthlyDetailTable('theme_code')">ğŸ·ï¸ Tema â‡…</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #FF5722;">ğŸ“‚ IPTC Kategorisi</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #FF5722; cursor: pointer;" onclick="sortMonthlyDetailTable('n_docs')">ğŸ“Š DokÃ¼man â‡…</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-detail-tbody">
                                <tr><td colspan="5" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi. "CSV Verilerini YÃ¼kle" butonuna tÄ±klayÄ±n.</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Ã–zet Ä°statistikler -->
                    <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="background: #fff3e0; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #FF5722;" id="detail-total-rows">0</div>
                            <div style="font-size: 0.85em; color: #666;">Toplam SatÄ±r</div>
                        </div>
                        <div style="background: #e3f2fd; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #2196F3;" id="detail-total-docs">0</div>
                            <div style="font-size: 0.85em; color: #666;">Toplam DokÃ¼man</div>
                        </div>
                        <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4CAF50;" id="detail-unique-themes">0</div>
                            <div style="font-size: 0.85em; color: #666;">FarklÄ± Tema</div>
                        </div>
                        <div style="background: #f3e5f5; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #9C27B0;" id="detail-avg-docs">0</div>
                            <div style="font-size: 0.85em; color: #666;">Ort. DokÃ¼man/Ay</div>
                        </div>
                    </div>
                </div>
                
                <!-- TABLO-4: Trend Analizi (BigQuery: gdelt_theme_trend_analysis_2022_2024.csv) -->
                <div class="chart-container" style="margin-top: 25px; border-left: 4px solid #9C27B0;">
                    <h4 style="color: #9C27B0; margin-bottom: 10px;">ğŸ“ˆ Tablo-4: Tema Trend Analizi (BigQuery: gdelt_theme_trend_analysis_2022_2024.csv)</h4>
                    <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                        Her tema iÃ§in 2022-2024 arasÄ± aylÄ±k trend eÄŸimi, kategorizasyon ve istatistikler - karar verme iÃ§in ek kriter
                    </p>
                    
                    <!-- Filtreler -->
                    <div style="margin-bottom: 15px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">Trend Kategorisi:</label>
                            <select id="trend-category-filter" onchange="updateTrendAnalysisTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px;">
                                <option value="ALL">TÃ¼mÃ¼</option>
                                <option value="Artan">ğŸ“ˆ Artan</option>
                                <option value="Azalan">ğŸ“‰ Azalan</option>
                                <option value="Stabil">â¡ï¸ Stabil</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">Min EÄŸim:</label>
                            <input type="number" id="trend-min-slope" value="-1" step="0.1" onchange="updateTrendAnalysisTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px; width: 80px;">
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em;">Max EÄŸim:</label>
                            <input type="number" id="trend-max-slope" value="1" step="0.1" onchange="updateTrendAnalysisTable()" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; margin-left: 5px; width: 80px;">
                        </div>
                        <span id="trend-count" style="color: #666; font-size: 0.9em;"></span>
                    </div>
                    
                    <!-- Tablo -->
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table id="trend-analysis-table" style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                            <thead style="position: sticky; top: 0; background: #f3e5f5;">
                                <tr>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #9C27B0; cursor: pointer;" onclick="sortTrendTable('theme_code')">ğŸ·ï¸ Tema Kodu â‡…</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #9C27B0;">ğŸ“‚ IPTC Kategorisi</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #9C27B0; cursor: pointer;" onclick="sortTrendTable('slope')">ğŸ“ˆ EÄŸim â‡…</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #9C27B0; cursor: pointer;" onclick="sortTrendTable('trend_category')">ğŸ“Š Trend â‡…</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #9C27B0; cursor: pointer;" onclick="sortTrendTable('avg_docs')">ğŸ“Š Ort. DokÃ¼man â‡…</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #9C27B0; cursor: pointer;" onclick="sortTrendTable('total_docs')">ğŸ“Š Toplam DokÃ¼man â‡…</th>
                                </tr>
                            </thead>
                            <tbody id="trend-analysis-tbody">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #999;">Trend analizi CSV'si yÃ¼klenmedi. "Trend Analizi YÃ¼kle" butonuna tÄ±klayÄ±n.</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Ã–zet Ä°statistikler -->
                    <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="background: #e1f5fe; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #0277bd;" id="trend-total-themes">0</div>
                            <div style="font-size: 0.85em; color: #666;">Toplam Tema</div>
                        </div>
                        <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #2e7d32;" id="trend-artan-count">0</div>
                            <div style="font-size: 0.85em; color: #666;">Artan Trend</div>
                        </div>
                        <div style="background: #ffebee; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #c62828;" id="trend-azalan-count">0</div>
                            <div style="font-size: 0.85em; color: #666;">Azalan Trend</div>
                        </div>
                        <div style="background: #f3e5f5; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #7b1fa2;" id="trend-stabil-count">0</div>
                            <div style="font-size: 0.85em; color: #666;">Stabil Trend</div>
                        </div>
                    </div>
                </div>
                
                <!-- ADIM A: IPTC Kategori Ã–zet KartlarÄ± -->
                <div class="chart-container" style="margin-top: 25px; border-left: 4px solid #9C27B0;">
                    <h4 style="color: #9C27B0; margin-bottom: 15px;">ğŸ¯ AdÄ±m A: IPTC Ãœst Kategoriler â€“ Tema ve DokÃ¼man Ã–zeti</h4>
                    <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                        17 IPTC Media Topic kategorisi iÃ§in tema sayÄ±sÄ±, toplam dokÃ¼man ve 6 Ã¼lke kapsamÄ± Ã¶zeti
                        <a href="https://iptc.org/standards/media-topics/" target="_blank" style="color: #9C27B0; text-decoration: none; margin-left: 5px;">â„¹ï¸ IPTC Referans</a>
                    </p>
                    
                    <!-- IPTC Kategori Ã–zet KartlarÄ± Grid -->
                    <div id="iptc-summary-cards-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; max-height: 500px; overflow-y: auto; padding: 5px;">
                        <!-- JavaScript ile doldurulacak -->
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">
                            CSV verilerini yÃ¼kleyip "Tema Analizi Yap" butonuna tÄ±klayÄ±n...
                        </div>
                    </div>
                </div>
                
                <!-- ADIM B: Ãœlke-Kategori KullanÄ±labilirlik Matrisi -->
                <div class="chart-container" style="margin-top: 25px; border-left: 4px solid #E91E63;">
                    <h4 style="color: #E91E63; margin-bottom: 15px;">ğŸ“Š AdÄ±m B: Ãœlke-Kategori KullanÄ±labilirlik Matrisi</h4>
                    <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                        âœ” = AylÄ±k sentiment iÃ§in uygun (â‰¥70%) | âš  = Quarterly gerekli (40-70%) | âœ– = Yetersiz (&lt;40%) | - = Veri yok
                    </p>
                    
                    <div style="overflow-x: auto; max-width: 100%;">
                        <table id="country-theme-matrix" style="border-collapse: collapse; font-size: 0.75em; text-align: center; min-width: 1200px;">
                            <thead style="background: linear-gradient(135deg, #E91E63 0%, #9C27B0 100%); color: white;">
                                <tr>
                                    <th style="padding: 8px; position: sticky; left: 0; background: #E91E63; z-index: 1;">Ãœlke</th>
                                    <!-- 17 IPTC kategorisi JavaScript ile doldurulacak -->
                                </tr>
                            </thead>
                            <tbody id="matrix-tbody">
                                <tr><td colspan="18" style="text-align: center; padding: 30px; color: #999;">AdÄ±m A tamamlandÄ±ÄŸÄ±nda matris otomatik oluÅŸturulur</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ADIM C: Analiz Ä°Ã§in Kategori SeÃ§imi ve KarÅŸÄ±laÅŸtÄ±rma -->
                <div class="chart-container" style="margin-top: 25px; border-left: 4px solid #2196F3;">
                    <h4 style="color: #2196F3; margin-bottom: 15px;">ğŸ” AdÄ±m C: Analiz Ä°Ã§in Kategori SeÃ§imi ve KarÅŸÄ±laÅŸtÄ±rma</h4>
                    <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                        17 kategoriden 5-6 tanesini seÃ§erek karÅŸÄ±laÅŸtÄ±rmalÄ± analiz yapÄ±n. YeÅŸil kategoriler Ã¶nerilir.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 350px 1fr; gap: 20px;">
                        <!-- Sol: Kategori SeÃ§im Listesi -->
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h5 style="color: #2196F3; margin: 0;">Kategori SeÃ§imi</h5>
                                <span id="selected-category-count" style="background: #2196F3; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.85em;">0 / 17</span>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <button onclick="selectRecommendedCategories()" style="padding: 5px 10px; font-size: 0.8em; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; margin-right: 5px;">ğŸ¯ Ã–nerilenleri SeÃ§</button>
                                <button onclick="clearCategorySelection()" style="padding: 5px 10px; font-size: 0.8em; cursor: pointer; background: #f44336; color: white; border: none; border-radius: 4px;">âœ– Temizle</button>
                            </div>
                            
                            <div id="iptc-selection-list" style="max-height: 400px; overflow-y: auto;">
                                <!-- JavaScript ile doldurulacak -->
                                <div style="text-align: center; padding: 20px; color: #999; font-size: 0.9em;">
                                    Ã–nce AdÄ±m A'yÄ± tamamlayÄ±n...
                                </div>
                            </div>
                        </div>
                        
                        <!-- SaÄŸ: SeÃ§ime GÃ¶re Grafik ve Ã–zet -->
                        <div>
                            <!-- SeÃ§ili Kategoriler Ã–zeti -->
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5 style="color: #1976D2; margin: 0 0 10px 0;">ğŸ“ˆ SeÃ§ili Kategoriler Ã–zeti</h5>
                                <div id="selected-categories-summary" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                                    <div style="text-align: center; color: #999; padding: 20px;">Kategori seÃ§in...</div>
                                </div>
                            </div>
                            
                            <!-- Ãœlke Ã— Kategori Hacim GrafiÄŸi -->
                            <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0;">
                                <h5 style="color: #333; margin: 0 0 10px 0;">Ãœlke Ã— Kategori DokÃ¼man DaÄŸÄ±lÄ±mÄ±</h5>
                                <div style="height: 250px;">
                                    <canvas id="category-country-bar-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- V1-V2 KarÅŸÄ±laÅŸtÄ±rma (Opsiyonel) -->
                            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <h5 style="color: #E65100; margin: 0 0 10px 0;">ğŸ”„ V1 vs V2 Algoritma FarkÄ±</h5>
                                <div id="v1-v2-comparison-table" style="font-size: 0.85em;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: #ffe0b2;">
                                                <th style="padding: 8px; text-align: left;">Kategori</th>
                                                <th style="padding: 8px; text-align: center;">V1 Tema</th>
                                                <th style="padding: 8px; text-align: center;">V2 Tema</th>
                                                <th style="padding: 8px; text-align: center;">Fark</th>
                                            </tr>
                                        </thead>
                                        <tbody id="v1-v2-tbody">
                                            <tr><td colspan="4" style="text-align: center; padding: 15px; color: #999;">Kategori seÃ§ildikten sonra gÃ¶rÃ¼ntÃ¼lenir</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Export Butonu -->
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="run-btn" style="background: #2196F3;" onclick="exportSelectedCategoriesAnalysis()" id="export-selected-btn">ğŸ“¤ SeÃ§ili Kategorilerin Analizini Ä°ndir</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB 5: EXPORT - GDELT/IPTC Export -->
        <div class="tab-content" id="tab-export">
            <div class="charts-section">
                <h3 style="color: #0f3460; margin-bottom: 20px; text-align: center;">ğŸ“¤ GDELT & IPTC Veri DÄ±ÅŸarÄ± Aktarma</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px;">
                    
                    <!-- GDELT TEMA EXPORT -->
                    <div class="chart-container" style="border-left: 4px solid #4CAF50;">
                        <h4 style="color: #4CAF50; margin-bottom: 15px;">ğŸ“‹ GDELT Tema Verileri</h4>
                        
                        <!-- SÃ¼tun SeÃ§imi -->
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: 600; color: #333; display: block; margin-bottom: 8px;">SÃ¼tunlar:</label>
                            <div id="export-columns-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; background: #f8f9fa; padding: 12px; border-radius: 5px; max-height: 200px; overflow-y: auto;">
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="country" checked> Ãœlke
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="theme_code" checked> Tema Kodu
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="total_docs" checked> Toplam DokÃ¼man
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="iptc_category" checked> IPTC Kategorisi
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="months_ok"> Uygun Ay SayÄ±sÄ±
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="months_total"> Toplam Ay
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="quality_ratio"> Kalite OranÄ±
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" class="export-col-checkbox" value="median_docs"> Median DokÃ¼man
                                </label>
                            </div>
                            <div style="margin-top: 8px; display: flex; align-items: center; gap: 10px;">
                                <button onclick="selectAllExportCols()" style="padding: 5px 10px; font-size: 0.85em; cursor: pointer;">TÃ¼mÃ¼nÃ¼ SeÃ§</button>
                                <button onclick="deselectAllExportCols()" style="padding: 5px 10px; font-size: 0.85em; cursor: pointer;">TÃ¼mÃ¼nÃ¼ KaldÄ±r</button>
                                <span id="selected-columns-count" style="font-size: 0.85em; color: #666;">0/8 sÃ¼tun seÃ§ili</span>
                            </div>
                        </div>
                        
                        <!-- IPTC Filtre SeÃ§imi -->
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: 600; color: #333; display: block; margin-bottom: 8px;">IPTC Kategori Filtresi:</label>
                            <select id="export-iptc-filter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="all">TÃ¼m Kategoriler</option>
                                <option value="economy, business and finance">ğŸ’° Economy</option>
                                <option value="conflict, war and peace">âš”ï¸ Conflict</option>
                                <option value="politics and government">ğŸ›ï¸ Politics</option>
                                <option value="health">ğŸ¥ Health</option>
                                <option value="education">ğŸ“š Education</option>
                                <option value="lifestyle and leisure">âœˆï¸ Lifestyle</option>
                                <option value="disaster, accident and emergency incident">ğŸš¨ Disaster</option>
                                <option value="environment">ğŸŒ Environment</option>
                                <option value="arts, culture, entertainment and media">ğŸ¨ Arts/Media</option>
                                <option value="society">ğŸ‘¥ Society</option>
                            </select>
                        </div>
                        
                        <!-- Export ButonlarÄ± -->
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="run-btn" style="background: #4CAF50;" onclick="exportGDELTDataXLSX()">
                                ğŸ“Š XLSX Ä°ndir
                            </button>
                            <button class="run-btn" style="background: #2196F3;" onclick="exportGDELTDataCSV()">
                                ğŸ“„ CSV Ä°ndir
                            </button>
                            <button class="run-btn" style="background: #9C27B0;" onclick="showGDELTLatexTable()">
                                ğŸ“ LaTeX Kodu
                            </button>
                        </div>
                        
                        <!-- LaTeX Ã–nizleme -->
                        <div id="latex-table-preview" style="display: none; margin-top: 15px;">
                            <label style="font-weight: 600; color: #9C27B0; display: block; margin-bottom: 8px;">LaTeX Tablo Kodu:</label>
                            <textarea id="latex-table-code" readonly style="width: 100%; height: 200px; font-family: monospace; font-size: 0.85em; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #f5f5f5;"></textarea>
                            <button onclick="copyLatexTable()" style="margin-top: 8px; padding: 8px 15px; cursor: pointer;">ğŸ“‹ Kopyala</button>
                        </div>
                    </div>
                    
                    <!-- IPTC MAPPING EXPORT -->
                    <div class="chart-container" style="border-left: 4px solid #FF9800;">
                        <h4 style="color: #FF9800; margin-bottom: 15px;">ğŸ¯ IPTC EÅŸleÅŸtirme SonuÃ§larÄ±</h4>
                        
                        <!-- IPTC Mapping Export SeÃ§enekleri -->
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: 600; color: #333; display: block; margin-bottom: 8px;">Export Ä°Ã§eriÄŸi:</label>
                            <div style="display: flex; flex-direction: column; gap: 8px; background: #f8f9fa; padding: 12px; border-radius: 5px;">
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" id="export-iptc-themes" checked> Tema-IPTC EÅŸleÅŸtirmeleri
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" id="export-iptc-summary" checked> IPTC Kategori Ã–zeti
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer;">
                                    <input type="checkbox" id="export-iptc-similarity"> Benzerlik Matrisi
                                </label>
                            </div>
                        </div>
                        
                        <!-- Export ButonlarÄ± -->
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="run-btn" style="background: #FF9800;" onclick="exportIPTCMappingJSON()">
                                ğŸ“‹ JSON Ä°ndir
                            </button>
                            <button class="run-btn" style="background: #E91E63;" onclick="exportIPTCMappingCSV()">
                                ğŸ“„ CSV Ä°ndir
                            </button>
                        </div>
                        
                        <!-- Grafik Export -->
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                            <h5 style="color: #FF9800; margin-bottom: 10px;">ğŸ“ˆ Grafik Export</h5>
                            <div style="margin-bottom: 10px;">
                                <label style="font-weight: 600; color: #333; display: block; margin-bottom: 8px;">Grafik SeÃ§in:</label>
                                <select id="export-chart-select" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 1em;">
                                    <option value="iptc-distribution-chart">ğŸ“Š IPTC Kategori DaÄŸÄ±lÄ±mÄ±</option>
                                    <option value="country-theme-chart">ğŸŒ Ãœlke BazlÄ± Tema Hacmi</option>
                                    <option value="top-themes-chart">ğŸ“ˆ En YÃ¼ksek Hacimli Temalar</option>
                                    <option value="iptc-similarity-chart">ğŸ¯ IPTC Benzerlik SkorlarÄ±</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="run-btn" style="background: #9C27B0;" onclick="exportChartPNG()">
                                    ğŸ–¼ï¸ PNG Ä°ndir
                                </button>
                                <button class="run-btn" style="background: #673AB7;" onclick="exportChartSVG()">
                                    ğŸ“ SVG Ä°ndir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- TOPLU EXPORT BÃ–LÃœMÃœ -->
                <div class="chart-container" style="margin-top: 20px; border-left: 4px solid #0f3460;">
                    <h4 style="color: #0f3460; margin-bottom: 15px;">ğŸ“¦ Toplu DÄ±ÅŸarÄ± Aktarma</h4>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">TÃ¼m GDELT tema verilerini ve IPTC eÅŸleÅŸtirmelerini tek seferde dÄ±ÅŸarÄ± aktarÄ±n.</p>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="run-btn" style="background: #0f3460;" onclick="exportAllGDELTData()">
                            ğŸ“Š TÃ¼m Verileri Ä°ndir (XLSX)
                        </button>
                        <button class="run-btn" style="background: #00BCD4;" onclick="exportAllChartsPNG()">
                            ğŸ–¼ï¸ TÃ¼m Grafikleri Ä°ndir (PNG)
                        </button>
                        <button class="run-btn" style="background: #795548;" onclick="exportFullReport()">
                            ğŸ“‘ Tam Rapor (ZIP)
                        </button>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                        <p style="font-size: 0.85em; color: #666; margin: 0;">
                            <strong>ğŸ’¡ Ä°pucu:</strong> Toplu export, GDELT tema analizi ve IPTC eÅŸleÅŸtirme sonuÃ§larÄ±nÄ± iÃ§erir. 
                            Ã–nce GDELT Tema sekmesinden CSV yÃ¼kleyin ve KÃ¼meleme sekmesinden IPTC eÅŸleÅŸtirmesini Ã§alÄ±ÅŸtÄ±rÄ±n.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // GDELT-IPTC Dashboard global degiskenler
        let allData = [];
        let chartsInitialized = false;
        let chartInstances = [];
        
        // GDELT veri deÄŸiÅŸkenleri
        let totalDocsData = [];
        let monthlyQualityData = [];
        let monthlyDetailData = [];
        
        // Eski fonksiyonlar icin stub'lar (runtime error onleme)
        function renderKaTeX() { }
        function updateInfoBox() { }
        
        // Durum mesaji goster
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
        }
        
        // TAB MANAGEMENT
        function switchTab(tabName) {
            // TÃ¼m tab button'larÄ± pasif yap
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            // TÃ¼m tab content'lerini gizle
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // SeÃ§ilen tab button'Ä±nÄ± aktif yap
            const tabButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (tabButton) {
                tabButton.classList.add('active');
            }
            
            // SeÃ§ilen tab content'ini gÃ¶ster
            const tabContent = document.getElementById(`tab-${tabName}`);
            if (tabContent) {
                tabContent.classList.add('active');
                
                // Grafikler sekmesinde grafikleri render et
                if (tabName === 'charts' && allData.length > 0) {
                    setTimeout(() => {
                        renderCharts();
                    }, 300);
                }
                
                // Export sekmesinde bilgileri gÃ¼ncelle
                if (tabName === 'export') {
                    updateExportInfo();
                }
            }
        }
        
        // Tab button event listeners
        function initTabButtons() {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const tabName = e.target.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        }
        
        // Pipeline butonlarÄ± baÅŸlat - GDELT Tema sekmesi buton durumlarÄ±
        function initPipelineButtons() {
            // CSV yÃ¼klenene kadar diÄŸer butonlar disabled
            const analyzeBtn = document.getElementById('analyze-themes-btn');
            const matrixBtn = document.getElementById('generate-matrix-btn');
            
            if (analyzeBtn) analyzeBtn.disabled = !gdeltDataLoaded;
            if (matrixBtn) matrixBtn.disabled = !gdeltDataLoaded;
        }
        
        // Export sekmesine geÃ§ildiÄŸinde Ã¶zet bilgileri gÃ¼ncelle
        function updateExportInfo() {
            // Mevcut veri durumunu kontrol et
            const hasGDELTData = totalDocsData && totalDocsData.length > 0;
            const hasIPTCMapping = iptcMappingResults && iptcMappingResults.themes;
            const hasMonthlyQuality = gdeltMonthlyQuality && gdeltMonthlyQuality.length > 0;
            
            // Export butonlarÄ±nÄ±n durumunu gÃ¼ncelle
            const gdeltExportBtns = document.querySelectorAll('#tab-export button[onclick*="exportGDELT"]');
            const iptcExportBtns = document.querySelectorAll('#tab-export button[onclick*="exportIPTC"]');
            const allExportBtns = document.querySelectorAll('#tab-export button[onclick*="exportAll"]');
            
            gdeltExportBtns.forEach(btn => {
                btn.disabled = !hasGDELTData;
                btn.title = hasGDELTData ? '' : 'Ã–nce GDELT verilerini yÃ¼kleyin';
            });
            
            iptcExportBtns.forEach(btn => {
                btn.disabled = !hasIPTCMapping;
                btn.title = hasIPTCMapping ? '' : 'Ã–nce IPTC eÅŸleÅŸtirmesini Ã§alÄ±ÅŸtÄ±rÄ±n';
            });
            
            allExportBtns.forEach(btn => {
                btn.disabled = !hasGDELTData;
            });
            
            // Ã–zet bilgi gÃ¶ster (varsa)
            console.log(`ğŸ“¤ Export durumu: GDELT=${hasGDELTData}, IPTC=${hasIPTCMapping}, Quality=${hasMonthlyQuality}`);
        }
        
        // Export filtre event listener'larÄ±nÄ± baÅŸlat
        function initExportFilters() {
            // "TÃ¼mÃ¼nÃ¼ SeÃ§" butonu
            const selectAllBtn = document.querySelector('#tab-export button[onclick*="selectAllColumns"]');
            const deselectAllBtn = document.querySelector('#tab-export button[onclick*="deselectAllColumns"]');
            
            // SÃ¼tun checkbox'larÄ±na change event ekle (sayÄ± gÃ¶stermek iÃ§in)
            const checkboxes = document.querySelectorAll('.export-col-checkbox');
            checkboxes.forEach(cb => {
                cb.addEventListener('change', updateSelectedColumnCount);
            });
            
            // Ä°lk yÃ¼klemede sayÄ±yÄ± gÃ¼ncelle
            updateSelectedColumnCount();
        }
        
        // SeÃ§ili sÃ¼tun sayÄ±sÄ±nÄ± gÃ¼ncelle
        function updateSelectedColumnCount() {
            const checked = document.querySelectorAll('.export-col-checkbox:checked').length;
            const total = document.querySelectorAll('.export-col-checkbox').length;
            const countEl = document.getElementById('selected-columns-count');
            if (countEl) {
                countEl.textContent = `${checked}/${total} sÃ¼tun seÃ§ili`;
            }
        }
        
        // TÃ¼m sÃ¼tunlarÄ± seÃ§
        function selectAllColumns() {
            document.querySelectorAll('.export-col-checkbox').forEach(cb => cb.checked = true);
            updateSelectedColumnCount();
        }
        
        // TÃ¼m sÃ¼tunlarÄ± kaldÄ±r
        function deselectAllColumns() {
            document.querySelectorAll('.export-col-checkbox').forEach(cb => cb.checked = false);
            updateSelectedColumnCount();
        }
        
        // Export sÃ¼tunlarÄ± seÃ§ (HTML'deki onclick iÃ§in alias)
        function selectAllExportCols() {
            selectAllColumns();
        }
        
        // Export sÃ¼tunlarÄ± kaldÄ±r (HTML'deki onclick iÃ§in alias)
        function deselectAllExportCols() {
            deselectAllColumns();
        }
        
        // ==================== KAYDETME / Ä°Ã‡E AKTARMA FONKSÄ°YONLARI ====================
        
        let lastClusteringResult = null;  // Son kÃ¼meleme sonucunu sakla
        
        // GDELT durumunu topla
        function collectGDELTState() {
            return {
                timestamp: new Date().toISOString(),
                dataType: 'gdelt-iptc',
                parameters: {
                    min_docs_threshold: parseInt(document.getElementById('min-docs-threshold')?.value) || 1000,
                    quality_threshold: parseInt(document.getElementById('quality-threshold')?.value) || 50,
                    similarity_threshold: parseFloat(document.getElementById('similarity-threshold')?.value) || 0.30,
                    iptc_filter: document.getElementById('iptc-filter-param')?.value || 'all'
                },
                gdeltData: {
                    totalDocs: totalDocsData || [],
                    monthlyQuality: monthlyQualityData || [],
                    monthlyDetail: monthlyDetailData || []
                },
                iptcMapping: iptcMappingResults || null,
                summary: {
                    totalThemes: totalDocsData ? new Set(totalDocsData.map(d => d.theme_code)).size : 0,
                    totalCountries: totalDocsData ? new Set(totalDocsData.map(d => d.country)).size : 0,
                    totalDocs: totalDocsData ? totalDocsData.reduce((s, d) => s + (d.total_docs || 0), 0) : 0,
                    iptcCategories: iptcMappingResults ? new Set(iptcMappingResults.mappings?.map(m => m.iptc_category)).size : 0
                }
            };
        }
        
        // Eski GDP-Mutluluk durumu (geriye uyumluluk)
        function collectCurrentState() {
            return {
                timestamp: new Date().toISOString(),
                parameters: {
                    start_year: 2022,
                    end_year: 2024
                },
                results: allData,
                summary: {},
                clustering: lastClusteringResult,
                currentMethod: currentMethod,
                currentFilter: currentFilter,
                currentVariableMode: currentVariableMode
            };
        }
        
        // GDELT durumunu uygula
        function applyGDELTState(state) {
            if (!state) return;
            
            // Parametreleri uygula
            if (state.parameters) {
                const minDocsEl = document.getElementById('min-docs-threshold');
                const qualityEl = document.getElementById('quality-threshold');
                const similarityEl = document.getElementById('similarity-threshold');
                const iptcFilterEl = document.getElementById('iptc-filter-param');
                
                if (minDocsEl) minDocsEl.value = state.parameters.min_docs_threshold || 1000;
                if (qualityEl) qualityEl.value = state.parameters.quality_threshold || 50;
                if (similarityEl) similarityEl.value = state.parameters.similarity_threshold || 0.30;
                if (iptcFilterEl) iptcFilterEl.value = state.parameters.iptc_filter || 'all';
            }
            
            // GDELT verilerini uygula
            if (state.gdeltData) {
                if (state.gdeltData.totalDocs && state.gdeltData.totalDocs.length > 0) {
                    totalDocsData = state.gdeltData.totalDocs;
                    updateTotalDocsTable();
                }
                if (state.gdeltData.monthlyQuality && state.gdeltData.monthlyQuality.length > 0) {
                    monthlyQualityData = state.gdeltData.monthlyQuality;
                    updateMonthlyQualityTable();
                }
                if (state.gdeltData.monthlyDetail) {
                    monthlyDetailData = state.gdeltData.monthlyDetail;
                }
            }
            
            // IPTC eÅŸleÅŸtirme sonuÃ§larÄ±nÄ± uygula
            if (state.iptcMapping) {
                iptcMappingResults = state.iptcMapping;
                displayIPTCMappingResults(iptcMappingResults);
            }
            
            // Ã–zet bilgilerini gÃ¶ster
            if (state.summary) {
                showStatus(`ğŸ“Š YÃ¼klendi: ${state.summary.totalThemes || 0} tema, ${state.summary.totalCountries || 0} Ã¼lke, ${(state.summary.totalDocs || 0).toLocaleString()} dokÃ¼man`, 'success');
            }
        }
        
        // Durumu uygula (geriye uyumluluk)
        function applyState(state) {
            if (!state) return;
            
            // GDELT formatÄ± mÄ± kontrol et
            if (state.dataType === 'gdelt-iptc') {
                applyGDELTState(state);
                return;
            }
            
            // Eski format - GDP/Mutluluk (geriye uyumluluk)
            if (state.results && state.results.length > 0) {
                allData = state.results;
            }
            
            // KÃ¼meleme sonuÃ§larÄ±nÄ± uygula
            if (state.clustering) {
                lastClusteringResult = state.clustering;
            }
        }
        
        // GDELT Analizi Kaydet
        async function saveGDELTAnalysis() {
            if (!totalDocsData || totalDocsData.length === 0) {
                showStatus('âš ï¸ Kaydetmek iÃ§in Ã¶nce GDELT verilerini yÃ¼kleyin!', 'error');
                return;
            }
            
            const saveBtn = document.getElementById('save-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<span class="loading-spinner"></span>Kaydediliyor...';
            
            try {
                const state = collectGDELTState();
                
                // JSON dosyasÄ± olarak indir (sunucu gerektirmez)
                const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `gdelt_iptc_analiz_${new Date().toISOString().slice(0,10)}.json`;
                link.click();
                
                showStatus('âœ… GDELT analizi JSON olarak indirildi!', 'success');
                
            } catch (error) {
                console.error('Kaydetme hatasÄ±:', error);
                showStatus(`âŒ Kaydetme hatasÄ±: ${error.message}`, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = 'ğŸ’¾ Kaydet';
            }
        }
        
        // Eski analizi kaydet (geriye uyumluluk)
        async function saveAnalysis() {
            saveGDELTAnalysis();
        }
        
        // Ä°Ã§e aktarma dialog'unu tetikle
        function triggerImport() {
            document.getElementById('import-file-input').click();
        }
        
        // GDELT dosyasÄ±nÄ± iÃ§e aktar
        async function handleGDELTImportFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const importBtn = document.getElementById('import-btn');
            importBtn.disabled = true;
            importBtn.innerHTML = '<span class="loading-spinner"></span>YÃ¼kleniyor...';
            
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                // Veri tipine gÃ¶re iÅŸle
                if (data.dataType === 'gdelt-iptc') {
                    applyGDELTState(data);
                    showStatus(`âœ… GDELT analizi yÃ¼klendi: ${file.name}`, 'success');
                } else {
                    // Eski format
                    applyState(data);
                    showStatus(`âœ… Analiz dosyasÄ± yÃ¼klendi: ${file.name}`, 'success');
                }
                
            } catch (error) {
                console.error('Ä°Ã§e aktarma hatasÄ±:', error);
                showStatus(`âŒ Ä°Ã§e aktarma hatasÄ±: ${error.message}`, 'error');
            } finally {
                importBtn.disabled = false;
                importBtn.innerHTML = 'ğŸ“¥ Ä°Ã§e Aktar';
                e.target.value = '';
            }
        }
        
        // Eski iÃ§e aktarma (geriye uyumluluk)
        async function handleImportFile(e) {
            handleGDELTImportFile(e);
        }
        
        // GDELT Filtreleri Uygula
        function applyGDELTFilters() {
            if (!totalDocsData || totalDocsData.length === 0) {
                showStatus('âš ï¸ Ã–nce GDELT verilerini yÃ¼kleyin!', 'error');
                return;
            }
            
            const minDocs = parseInt(document.getElementById('min-docs-threshold').value) || 0;
            const minQuality = parseInt(document.getElementById('quality-threshold').value) || 0;
            const iptcFilter = document.getElementById('iptc-filter-param').value;
            
            // FiltrelenmiÅŸ sayÄ±larÄ± hesapla
            let filteredDocs = totalDocsData.filter(item => (item.total_docs || 0) >= minDocs);
            
            if (iptcFilter !== 'all') {
                filteredDocs = filteredDocs.filter(item => {
                    const iptc = getIPTCCategory(item.theme_code);
                    return iptc && iptc.toLowerCase() === iptcFilter.toLowerCase();
                });
            }
            
            const totalFiltered = filteredDocs.length;
            const themeCount = new Set(filteredDocs.map(d => d.theme_code)).size;
            const countryCount = new Set(filteredDocs.map(d => d.country)).size;
            
            showStatus(`ğŸ” Filtre uygulandÄ±: ${totalFiltered} kayÄ±t (${themeCount} tema, ${countryCount} Ã¼lke)`, 'success');
            
            // TablolarÄ± gÃ¼ncelle
            updateTotalDocsTable();
            updateMonthlyQualityTable();
        }
        
        // Filtreleri SÄ±fÄ±rla
        function resetGDELTFilters() {
            document.getElementById('min-docs-threshold').value = 1000;
            document.getElementById('quality-threshold').value = 50;
            document.getElementById('similarity-threshold').value = 0.30;
            document.getElementById('iptc-filter-param').value = 'all';
            
            showStatus('ğŸ”„ Filtreler sÄ±fÄ±rlandÄ±', 'info');
            
            // TablolarÄ± gÃ¼ncelle
            if (totalDocsData && totalDocsData.length > 0) {
                updateTotalDocsTable();
                updateMonthlyQualityTable();
            }
        }
        
        // Otomatik yÃ¼kleme (sayfa aÃ§Ä±lÄ±ÅŸÄ±nda)
        async function autoLoadLastAnalysis() {
            // LocalStorage'dan son durumu yÃ¼kle
            try {
                const savedState = localStorage.getItem('gdelt_iptc_last_state');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    if (state.dataType === 'gdelt-iptc' && state.gdeltData) {
                        console.log('ğŸ“‚ LocalStorage\'dan son durum yÃ¼kleniyor...');
                        applyGDELTState(state);
                    }
                }
            } catch (error) {
                console.log('LocalStorage yÃ¼kleme hatasÄ±:', error.message);
            }
        }
        
        // ==================== KAYDETME / Ä°Ã‡E AKTARMA FONKSÄ°YONLARI SONU ====================
        
        // ==================== GDELT DIÅARI AKTARMA FONKSÄ°YONLARI ====================
        
        // GDELT Veri Export - XLSX
        function exportGDELTDataXLSX() {
            if (!totalDocsData || totalDocsData.length === 0) {
                showStatus('âŒ DÄ±ÅŸarÄ± aktarÄ±lacak GDELT verisi yok! Ã–nce CSV yÃ¼kleyin.', 'error');
                return;
            }
            
            const columns = getSelectedGDELTColumns();
            if (columns.length === 0) {
                showStatus('âŒ En az bir sÃ¼tun seÃ§melisiniz!', 'error');
                return;
            }
            
            const iptcFilter = document.getElementById('export-iptc-filter').value;
            let filteredData = totalDocsData;
            
            if (iptcFilter !== 'all') {
                filteredData = totalDocsData.filter(item => {
                    const iptcCat = getIPTCCategory(item.theme_code);
                    return iptcCat && iptcCat.toLowerCase() === iptcFilter.toLowerCase();
                });
            }
            
            if (filteredData.length === 0) {
                showStatus('âŒ Filtreye uyan veri yok!', 'error');
                return;
            }
            
            // Veriyi hazÄ±rla
            const exportData = filteredData.map(item => {
                const row = {};
                const iptcCat = getIPTCCategory(item.theme_code);
                
                columns.forEach(col => {
                    if (col === 'country') row['Ãœlke'] = item.country || '-';
                    else if (col === 'theme_code') row['Tema Kodu'] = item.theme_code || '-';
                    else if (col === 'total_docs') row['Toplam DokÃ¼man'] = item.total_docs || 0;
                    else if (col === 'iptc_category') row['IPTC Kategorisi'] = iptcCat || '-';
                    else if (col === 'months_ok') row['Uygun Ay SayÄ±sÄ±'] = item.months_ok || 0;
                    else if (col === 'months_total') row['Toplam Ay'] = item.months_total || 0;
                    else if (col === 'quality_ratio') {
                        const ratio = item.months_total > 0 ? (item.months_ok / item.months_total * 100).toFixed(1) : 0;
                        row['Kalite OranÄ± (%)'] = ratio;
                    }
                    else if (col === 'median_docs') row['Median DokÃ¼man'] = item.median_monthly_docs || 0;
                });
                return row;
            });
            
            // XLSX oluÅŸtur
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'GDELT Tema Verileri');
            
            // Ä°ndir
            const filename = `gdelt_tema_verileri_${new Date().toISOString().slice(0,10)}.xlsx`;
            XLSX.writeFile(wb, filename);
            
            showStatus(`âœ… ${filteredData.length} satÄ±r GDELT verisi XLSX olarak indirildi!`, 'success');
        }
        
        // GDELT Veri Export - CSV
        function exportGDELTDataCSV() {
            if (!totalDocsData || totalDocsData.length === 0) {
                showStatus('âŒ DÄ±ÅŸarÄ± aktarÄ±lacak GDELT verisi yok! Ã–nce CSV yÃ¼kleyin.', 'error');
                return;
            }
            
            const columns = getSelectedGDELTColumns();
            if (columns.length === 0) {
                showStatus('âŒ En az bir sÃ¼tun seÃ§melisiniz!', 'error');
                return;
            }
            
            const iptcFilter = document.getElementById('export-iptc-filter').value;
            let filteredData = totalDocsData;
            
            if (iptcFilter !== 'all') {
                filteredData = totalDocsData.filter(item => {
                    const iptcCat = getIPTCCategory(item.theme_code);
                    return iptcCat && iptcCat.toLowerCase() === iptcFilter.toLowerCase();
                });
            }
            
            if (filteredData.length === 0) {
                showStatus('âŒ Filtreye uyan veri yok!', 'error');
                return;
            }
            
            // Column headers
            const headers = {
                'country': 'Ãœlke',
                'theme_code': 'Tema Kodu',
                'total_docs': 'Toplam DokÃ¼man',
                'iptc_category': 'IPTC Kategorisi',
                'months_ok': 'Uygun Ay SayÄ±sÄ±',
                'months_total': 'Toplam Ay',
                'quality_ratio': 'Kalite OranÄ± (%)',
                'median_docs': 'Median DokÃ¼man'
            };
            
            let csv = columns.map(col => headers[col] || col).join(',') + '\n';
            
            filteredData.forEach(item => {
                const iptcCat = getIPTCCategory(item.theme_code);
                const row = columns.map(col => {
                    if (col === 'country') return `"${item.country || ''}"`;
                    if (col === 'theme_code') return item.theme_code || '';
                    if (col === 'total_docs') return item.total_docs || 0;
                    if (col === 'iptc_category') return `"${iptcCat || ''}"`;
                    if (col === 'months_ok') return item.months_ok || 0;
                    if (col === 'months_total') return item.months_total || 0;
                    if (col === 'quality_ratio') {
                        return item.months_total > 0 ? (item.months_ok / item.months_total * 100).toFixed(1) : 0;
                    }
                    if (col === 'median_docs') return item.median_monthly_docs || 0;
                    return '';
                }).join(',');
                csv += row + '\n';
            });
            
            // Ä°ndir
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `gdelt_tema_verileri_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
            
            showStatus(`âœ… ${filteredData.length} satÄ±r GDELT verisi CSV olarak indirildi!`, 'success');
        }
        
        // GDELT LaTeX Tablosu
        function showGDELTLatexTable() {
            if (!totalDocsData || totalDocsData.length === 0) {
                showStatus('âŒ GDELT verisi yok! Ã–nce CSV yÃ¼kleyin.', 'error');
                return;
            }
            
            const columns = getSelectedGDELTColumns();
            
            // IPTC kategorilerine gÃ¶re grupla
            const iptcGroups = {};
            totalDocsData.forEach(item => {
                const iptcCat = getIPTCCategory(item.theme_code);
                if (iptcCat) {
                    if (!iptcGroups[iptcCat]) iptcGroups[iptcCat] = [];
                    iptcGroups[iptcCat].push(item);
                }
            });
            
            // Top 15 IPTC grupla
            const sortedIPTC = Object.entries(iptcGroups)
                .map(([cat, items]) => ({
                    category: cat,
                    totalDocs: items.reduce((sum, i) => sum + (i.total_docs || 0), 0),
                    themeCount: new Set(items.map(i => i.theme_code)).size
                }))
                .sort((a, b) => b.totalDocs - a.totalDocs)
                .slice(0, 10);
            
            let latex = '\\begin{table}[htbp]\n';
            latex += '\\centering\n';
            latex += '\\caption{GDELT Tema - IPTC Media Topics EÅŸleÅŸtirme Ã–zeti}\n';
            latex += '\\label{tab:gdelt-iptc}\n';
            latex += '\\begin{tabular}{lrr}\n';
            latex += '\\toprule\n';
            latex += 'IPTC Kategori & Tema SayÄ±sÄ± & Toplam DokÃ¼man \\\\\n';
            latex += '\\midrule\n';
            
            sortedIPTC.forEach(item => {
                const catName = item.category.replace(/&/g, '\\&').replace(/_/g, '\\_');
                latex += `${catName} & ${item.themeCount} & ${item.totalDocs.toLocaleString()} \\\\\n`;
            });
            
            latex += '\\bottomrule\n';
            latex += '\\end{tabular}\n';
            latex += '\\end{table}\n';
            
            document.getElementById('latex-table-code').value = latex;
            document.getElementById('latex-table-preview').style.display = 'block';
            
            showStatus('âœ… LaTeX tablo kodu oluÅŸturuldu!', 'success');
        }
        
        // SeÃ§ili GDELT sÃ¼tunlarÄ±nÄ± al
        function getSelectedGDELTColumns() {
            const checkboxes = document.querySelectorAll('.export-col-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }
        
        // IPTC Mapping JSON Export
        function exportIPTCMappingJSON() {
            if (!iptcMappingResults) {
                showStatus('âŒ IPTC eÅŸleÅŸtirme sonucu yok! Ã–nce KÃ¼meleme sekmesinden IPTC eÅŸleÅŸtirmesini Ã§alÄ±ÅŸtÄ±rÄ±n.', 'error');
                return;
            }
            
            const includeThemes = document.getElementById('export-iptc-themes').checked;
            const includeSummary = document.getElementById('export-iptc-summary').checked;
            
            const exportData = {};
            
            if (includeThemes && iptcMappingResults.mappings) {
                exportData.mappings = iptcMappingResults.mappings;
            }
            
            if (includeSummary) {
                // IPTC Ã¶zeti oluÅŸtur
                const summary = {};
                if (iptcMappingResults.mappings) {
                    iptcMappingResults.mappings.forEach(m => {
                        const cat = m.iptc_category;
                        if (!summary[cat]) {
                            summary[cat] = { count: 0, themes: [], avgSimilarity: 0 };
                        }
                        summary[cat].count++;
                        summary[cat].themes.push(m.theme_code);
                        summary[cat].avgSimilarity += m.similarity;
                    });
                    
                    Object.keys(summary).forEach(cat => {
                        summary[cat].avgSimilarity /= summary[cat].count;
                        summary[cat].avgSimilarity = summary[cat].avgSimilarity.toFixed(4);
                    });
                }
                exportData.summary = summary;
            }
            
            exportData.exportDate = new Date().toISOString();
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `iptc_mapping_${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            
            showStatus('âœ… IPTC eÅŸleÅŸtirme JSON olarak indirildi!', 'success');
        }
        
        // IPTC Mapping CSV Export
        function exportIPTCMappingCSV() {
            if (!iptcMappingResults || !iptcMappingResults.mappings) {
                showStatus('âŒ IPTC eÅŸleÅŸtirme sonucu yok! Ã–nce KÃ¼meleme sekmesinden IPTC eÅŸleÅŸtirmesini Ã§alÄ±ÅŸtÄ±rÄ±n.', 'error');
                return;
            }
            
            let csv = 'theme_code,theme_label,iptc_category,similarity\n';
            
            iptcMappingResults.mappings.forEach(m => {
                csv += `"${m.theme_code}","${m.theme_label || ''}","${m.iptc_category}",${m.similarity}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `iptc_mapping_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
            
            showStatus('âœ… IPTC eÅŸleÅŸtirme CSV olarak indirildi!', 'success');
        }
        
        // TÃ¼m GDELT Verilerini Export
        function exportAllGDELTData() {
            if (!totalDocsData || totalDocsData.length === 0) {
                showStatus('âŒ DÄ±ÅŸarÄ± aktarÄ±lacak veri yok! Ã–nce CSV yÃ¼kleyin.', 'error');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            
            // Sheet 1: Total Docs
            const totalDocsExport = totalDocsData.map(item => ({
                'Ãœlke': item.country,
                'Tema Kodu': item.theme_code,
                'IPTC Kategorisi': getIPTCCategory(item.theme_code) || '-',
                'Toplam DokÃ¼man': item.total_docs
            }));
            const ws1 = XLSX.utils.json_to_sheet(totalDocsExport);
            XLSX.utils.book_append_sheet(wb, ws1, 'Tema Toplam');
            
            // Sheet 2: Monthly Quality (if exists)
            if (monthlyQualityData && monthlyQualityData.length > 0) {
                const qualityExport = monthlyQualityData.map(item => ({
                    'Ãœlke': item.country,
                    'Tema Kodu': item.theme_code,
                    'IPTC Kategorisi': getIPTCCategory(item.theme_code) || '-',
                    'Uygun Ay': item.months_ok,
                    'Toplam Ay': item.months_total,
                    'Oran (%)': item.months_total > 0 ? (item.months_ok / item.months_total * 100).toFixed(1) : 0
                }));
                const ws2 = XLSX.utils.json_to_sheet(qualityExport);
                XLSX.utils.book_append_sheet(wb, ws2, 'AylÄ±k Kalite');
            }
            
            // Sheet 3: IPTC Summary
            const iptcSummary = {};
            totalDocsData.forEach(item => {
                const iptc = getIPTCCategory(item.theme_code);
                if (iptc) {
                    if (!iptcSummary[iptc]) {
                        iptcSummary[iptc] = { totalDocs: 0, themeCount: new Set(), countryCount: new Set() };
                    }
                    iptcSummary[iptc].totalDocs += item.total_docs || 0;
                    iptcSummary[iptc].themeCount.add(item.theme_code);
                    iptcSummary[iptc].countryCount.add(item.country);
                }
            });
            
            const iptcExport = Object.entries(iptcSummary).map(([cat, data]) => ({
                'IPTC Kategori': cat,
                'Toplam DokÃ¼man': data.totalDocs,
                'Tema SayÄ±sÄ±': data.themeCount.size,
                'Ãœlke SayÄ±sÄ±': data.countryCount.size
            })).sort((a, b) => b['Toplam DokÃ¼man'] - a['Toplam DokÃ¼man']);
            
            const ws3 = XLSX.utils.json_to_sheet(iptcExport);
            XLSX.utils.book_append_sheet(wb, ws3, 'IPTC Ã–zet');
            
            // Ä°ndir
            const filename = `gdelt_iptc_tam_veri_${new Date().toISOString().slice(0,10)}.xlsx`;
            XLSX.writeFile(wb, filename);
            
            showStatus('âœ… TÃ¼m GDELT verileri Ã§oklu sayfa XLSX olarak indirildi!', 'success');
        }
        
        // Tam Rapor (ZIP)
        async function exportFullReport() {
            showStatus('ğŸ“¦ Tam rapor hazÄ±rlanÄ±yor...', 'info');
            
            // JSZip kontrolÃ¼
            if (typeof JSZip === 'undefined') {
                showStatus('âš ï¸ ZIP desteÄŸi iÃ§in JSZip kÃ¼tÃ¼phanesi gerekli. Tek tek dosyalarÄ± indirin.', 'error');
                return;
            }
            
            const zip = new JSZip();
            
            // CSV Verileri
            if (totalDocsData && totalDocsData.length > 0) {
                let csv = 'country,theme_code,iptc_category,total_docs\n';
                totalDocsData.forEach(item => {
                    csv += `"${item.country}","${item.theme_code}","${getIPTCCategory(item.theme_code) || ''}",${item.total_docs}\n`;
                });
                zip.file('gdelt_tema_verileri.csv', csv);
            }
            
            // IPTC Mapping JSON
            if (iptcMappingResults) {
                zip.file('iptc_mapping.json', JSON.stringify(iptcMappingResults, null, 2));
            }
            
            // README
            const readme = `# GDELT & IPTC Media Topics Raporu
OluÅŸturulma Tarihi: ${new Date().toLocaleString('tr-TR')}

## Dosyalar
- gdelt_tema_verileri.csv: GDELT tema verileri
- iptc_mapping.json: IPTC eÅŸleÅŸtirme sonuÃ§larÄ±

## IPTC Kategorileri
${Object.keys(IPTC_CATEGORIES).map(c => `- ${c}`).join('\n')}
`;
            zip.file('README.md', readme);
            
            // ZIP oluÅŸtur ve indir
            const blob = await zip.generateAsync({ type: 'blob' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `gdelt_iptc_rapor_${new Date().toISOString().slice(0,10)}.zip`;
            link.click();
            
            showStatus('âœ… Tam rapor ZIP olarak indirildi!', 'success');
        }
        
        // ==================== DIÅARI AKTARMA FONKSÄ°YONLARI SONU ====================
        
        // ==================== GDELT TEMA KÃœMELEMESÄ° FONKSÄ°YONLARI ====================
        
        // Her iki algoritmanÄ±n sonuÃ§larÄ±nÄ± ayrÄ± sakla
        let iptcMappingResultsV1 = null;
        let iptcMappingResultsV2 = null;
        let iptcMappingResults = null;  // Aktif sonuÃ§ (v1 veya v2)
        let activeMapping = 'v2';  // VarsayÄ±lan olarak v2
        
        // V1 algoritmasÄ±nÄ± Ã§alÄ±ÅŸtÄ±r
        async function runIPTCMappingV1() {
            showIPTCProgress();
            showIPTCMappingStatus('ğŸš€ V1 (Sadece Embedding) Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor...', 'info');
            document.getElementById('v1-status').innerHTML = '<span class="loading-spinner" style="width:16px;height:16px;display:inline-block;"></span> Ã‡alÄ±ÅŸÄ±yor...';
            
            try {
                updateIPTCProgressStep(1, 'active');
                
                const response = await fetch('/api/run-iptc-mapping', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ algorithm: 'v1' })
                });
                
                if (!response.ok) {
                    throw new Error('API hatasÄ±: ' + response.status);
                }
                
                const data = await response.json();
                iptcMappingResultsV1 = data;
                
                // TÃ¼m adÄ±mlarÄ± tamamla
                for (let i = 1; i <= 6; i++) {
                    updateIPTCProgressStep(i, 'completed');
                }
                
                const themeCount = data.themes ? data.themes.length : 0;
                document.getElementById('v1-status').innerHTML = `<span style="color: #4CAF50;">âœ“ ${themeCount} tema</span>`;
                
                setTimeout(() => hideIPTCProgress(), 1000);
                showIPTCMappingStatus(`âœ… V1 tamamlandÄ±! ${themeCount} tema eÅŸleÅŸtirildi.`, 'success');
                
                // EÄŸer aktif mapping v1 ise sonuÃ§larÄ± gÃ¶ster
                if (activeMapping === 'v1') {
                    iptcMappingResults = iptcMappingResultsV1;
                    displayIPTCMappingResults(data);
                }
                
                // t-SNE grafiÄŸini gÃ¼ncelle
                createTSNEScatterChartV1();
                
            } catch (error) {
                hideIPTCProgress();
                document.getElementById('v1-status').innerHTML = '<span style="color: #f44336;">âŒ Hata</span>';
                showIPTCMappingStatus('âŒ V1 hatasÄ±: ' + error.message, 'error');
            }
        }
        
        // V2 algoritmasÄ±nÄ± Ã§alÄ±ÅŸtÄ±r
        async function runIPTCMappingV2() {
            showIPTCProgress();
            showIPTCMappingStatus('ğŸš€ V2 (Ä°ki KatmanlÄ± Fusion) Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor...', 'info');
            document.getElementById('v2-status').innerHTML = '<span class="loading-spinner" style="width:16px;height:16px;display:inline-block;"></span> Ã‡alÄ±ÅŸÄ±yor...';
            
            try {
                updateIPTCProgressStep(1, 'active');
                
                const response = await fetch('/api/run-iptc-mapping', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ algorithm: 'v2' })
                });
                
                if (!response.ok) {
                    throw new Error('API hatasÄ±: ' + response.status);
                }
                
                const data = await response.json();
                iptcMappingResultsV2 = data;
                
                // TÃ¼m adÄ±mlarÄ± tamamla
                for (let i = 1; i <= 6; i++) {
                    updateIPTCProgressStep(i, 'completed');
                }
                
                const themeCount = data.themes ? data.themes.length : 0;
                document.getElementById('v2-status').innerHTML = `<span style="color: #4CAF50;">âœ“ ${themeCount} tema</span>`;
                
                setTimeout(() => hideIPTCProgress(), 1000);
                showIPTCMappingStatus(`âœ… V2 tamamlandÄ±! ${themeCount} tema eÅŸleÅŸtirildi.`, 'success');
                
                // EÄŸer aktif mapping v2 ise sonuÃ§larÄ± gÃ¶ster
                if (activeMapping === 'v2') {
                    iptcMappingResults = iptcMappingResultsV2;
                    displayIPTCMappingResults(data);
                }
                
                // t-SNE grafiÄŸini gÃ¼ncelle
                createTSNEScatterChartV2();
                
            } catch (error) {
                hideIPTCProgress();
                document.getElementById('v2-status').innerHTML = '<span style="color: #f44336;">âŒ Hata</span>';
                showIPTCMappingStatus('âŒ V2 hatasÄ±: ' + error.message, 'error');
            }
        }
        
        // V1 sonuÃ§larÄ±nÄ± yÃ¼kle
        async function loadIPTCMappingResultsV1() {
            try {
                const response = await fetch('gdelt_iptc_mapping_v1.json');
                if (!response.ok) throw new Error('File not found');
                const data = await response.json();
                iptcMappingResultsV1 = data;
                
                const themeCount = data.themes ? data.themes.length : data.metadata?.total_themes || 0;
                document.getElementById('v1-status').innerHTML = `<span style="color: #4CAF50;">âœ“ ${themeCount} tema yÃ¼klendi</span>`;
                
                showIPTCMappingStatus('âœ… V1 sonuÃ§larÄ± yÃ¼klendi!', 'success');
                
                // EÄŸer aktif mapping v1 ise sonuÃ§larÄ± gÃ¶ster
                if (activeMapping === 'v1') {
                    iptcMappingResults = iptcMappingResultsV1;
                    displayIPTCMappingResults(data);
                }
                
                // t-SNE grafiÄŸini gÃ¼ncelle
                createTSNEScatterChartV1();
                
            } catch (error) {
                document.getElementById('v1-status').innerHTML = '<span style="color: #f44336;">âŒ Dosya bulunamadÄ±</span>';
                showIPTCMappingStatus('âŒ V1 sonuÃ§larÄ± bulunamadÄ±. Terminalde Ã§alÄ±ÅŸtÄ±rÄ±n: python gdelt_iptc_mapping.py', 'error');
            }
        }
        
        // V2 sonuÃ§larÄ±nÄ± yÃ¼kle
        async function loadIPTCMappingResultsV2() {
            try {
                const response = await fetch('gdelt_iptc_mapping_v2.json');
                if (!response.ok) throw new Error('File not found');
                const data = await response.json();
                iptcMappingResultsV2 = data;
                
                const themeCount = data.themes ? data.themes.length : data.metadata?.total_themes || 0;
                document.getElementById('v2-status').innerHTML = `<span style="color: #4CAF50;">âœ“ ${themeCount} tema yÃ¼klendi</span>`;
                
                showIPTCMappingStatus('âœ… V2 sonuÃ§larÄ± yÃ¼klendi!', 'success');
                
                // EÄŸer aktif mapping v2 ise sonuÃ§larÄ± gÃ¶ster
                if (activeMapping === 'v2') {
                    iptcMappingResults = iptcMappingResultsV2;
                    displayIPTCMappingResults(data);
                }
                
                // t-SNE grafiÄŸini gÃ¼ncelle
                createTSNEScatterChartV2();
                
            } catch (error) {
                document.getElementById('v2-status').innerHTML = '<span style="color: #f44336;">âŒ Dosya bulunamadÄ±</span>';
                showIPTCMappingStatus('âŒ V2 sonuÃ§larÄ± bulunamadÄ±. Terminalde Ã§alÄ±ÅŸtÄ±rÄ±n: python gdelt_iptc_mapping_v2.py', 'error');
            }
        }
        
        // Aktif mapping'i deÄŸiÅŸtir
        function switchActiveMapping() {
            const select = document.getElementById('active-mapping-select');
            activeMapping = select.value;
            
            const infoEl = document.getElementById('active-mapping-info');
            
            if (activeMapping === 'v1') {
                if (iptcMappingResultsV1) {
                    iptcMappingResults = iptcMappingResultsV1;
                    displayIPTCMappingResults(iptcMappingResultsV1);
                    infoEl.innerHTML = '<span style="color: #4CAF50;">âœ“ V1 sonuÃ§larÄ± kullanÄ±lÄ±yor</span>';
                } else {
                    infoEl.innerHTML = '<span style="color: #f44336;">V1 sonuÃ§larÄ± yÃ¼klenmedi!</span>';
                }
            } else {
                if (iptcMappingResultsV2) {
                    iptcMappingResults = iptcMappingResultsV2;
                    displayIPTCMappingResults(iptcMappingResultsV2);
                    infoEl.innerHTML = '<span style="color: #4CAF50;">âœ“ V2 sonuÃ§larÄ± kullanÄ±lÄ±yor</span>';
                } else {
                    infoEl.innerHTML = '<span style="color: #f44336;">V2 sonuÃ§larÄ± yÃ¼klenmedi!</span>';
                }
            }
        }
        
        // Eski fonksiyonlarÄ± uyumluluk iÃ§in koru
        async function runIPTCMapping() {
            if (activeMapping === 'v1') {
                runIPTCMappingV1();
            } else {
                runIPTCMappingV2();
            }
        }
        
        async function loadIPTCMappingResults() {
            // Her iki sonucu da yÃ¼klemeye Ã§alÄ±ÅŸ
            await Promise.all([
                loadIPTCMappingResultsV1().catch(() => {}),
                loadIPTCMappingResultsV2().catch(() => {})
            ]);
        }
        
        // IPTC eÅŸleÅŸtirme sonuÃ§larÄ±nÄ± gÃ¶ster
        function displayIPTCMappingResults(results) {
            if (!results || !results.iptc_categories) {
                showIPTCMappingStatus('âŒ GeÃ§ersiz veri formatÄ±', 'error');
                return;
            }
            
            // IPTC kategorileri iÃ§in renk haritasÄ± (17 kategori)
            const iptcColors = {
                'arts, culture, entertainment and media': '#E91E63',
                'crime, law and justice': '#9C27B0',
                'disaster, accident and emergency incident': '#F44336',
                'economy, business and finance': '#FF9800',
                'education': '#3F51B5',
                'environment': '#4CAF50',
                'health': '#00BCD4',
                'human interest': '#FF5722',
                'labour': '#795548',
                'lifestyle and leisure': '#E91E63',
                'politics and government': '#2196F3',
                'religion': '#673AB7',
                'science and technology': '#009688',
                'society': '#607D8B',
                'sport': '#8BC34A',
                'conflict, war and peace': '#F44336',
                'weather': '#03A9F4'
            };
            
            // IPTC kategori kartlarÄ±nÄ± oluÅŸtur
            const grid = document.getElementById('iptc-categories-grid');
            grid.innerHTML = '';
            
            // Kategorileri tema sayÄ±sÄ±na gÃ¶re sÄ±rala
            const sortedCategories = Object.entries(results.iptc_categories)
                .sort((a, b) => b[1].theme_count - a[1].theme_count);
            
            // Her kategori iÃ§in ortalama benzerliÄŸi hesapla (themes verisinden)
            const themesByCategory = {};
            if (results.themes) {
                results.themes.forEach(t => {
                    const cat = t.iptc_final_label || t.iptc_label;
                    if (cat) {
                        if (!themesByCategory[cat]) themesByCategory[cat] = [];
                        themesByCategory[cat].push(t.nn_score || t.similarity || 0);
                    }
                });
            }
            
            for (const [categoryLabel, info] of sortedCategories) {
                const color = iptcColors[categoryLabel] || '#667eea';
                
                const card = document.createElement('div');
                card.style.cssText = `
                    background: white;
                    border-left: 5px solid ${color};
                    padding: 15px;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    text-align: left;
                `;
                
                const themesList = info.themes.slice(0, 4).map(t => 
                    `<span style="background: ${color}15; color: ${color}; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: 500;">${t}</span>`
                ).join('');
                
                // Ortalama benzerlik hesapla
                const catScores = themesByCategory[categoryLabel] || [];
                const avgSim = catScores.length > 0 
                    ? ((catScores.reduce((a, b) => a + b, 0) / catScores.length) * 100).toFixed(1) 
                    : (info.avg_similarity ? (info.avg_similarity * 100).toFixed(1) : '-');
                
                card.innerHTML = `
                    <h4 style="color: ${color}; margin: 0 0 8px 0; font-size: 1em; text-transform: capitalize;">
                        ${categoryLabel}
                    </h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                        <span style="background: ${color}20; color: ${color}; padding: 3px 8px; border-radius: 4px; font-size: 0.85em;">
                            ${info.theme_count} tema
                        </span>
                        <span style="background: #e3f2fd; color: #2196F3; padding: 3px 8px; border-radius: 4px; font-size: 0.85em;">
                            %${avgSim} benzerlik
                        </span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px;">
                        ${themesList}
                        ${info.themes.length > 4 ? `<span style="color: #999; font-size: 0.8em;">+${info.themes.length - 4} daha</span>` : ''}
                    </div>
                `;
                
                grid.appendChild(card);
            }
            
            // TemalarÄ± tabloya ekle
            displayIPTCThemesTable(results.themes);
        }
        
        // TÃ¼m temalarÄ± IPTC tablosuyla gÃ¶ster
        function displayIPTCThemesTable(themes) {
            const tbody = document.getElementById('iptc-themes-tbody');
            tbody.innerHTML = '';
            
            // Benzerlik skoruna gÃ¶re sÄ±rala (yÃ¼ksekten dÃ¼ÅŸÃ¼ÄŸe)
            const sortedThemes = [...themes].sort((a, b) => (b.nn_score || b.similarity || 0) - (a.nn_score || a.similarity || 0));
            
            sortedThemes.forEach(theme => {
                // V2 formatÄ± iÃ§in alan eÅŸleÅŸtirmesi
                const iptcLabel = theme.iptc_final_label || theme.iptc_label || '-';
                const similarityVal = theme.nn_score || theme.similarity || 0;
                const similarity = similarityVal ? (similarityVal * 100).toFixed(1) : '-';
                const confidenceVal = theme.final_confidence || theme.confidence || 0;
                const confidence = confidenceVal ? (confidenceVal * 100).toFixed(1) : '-';
                const secondLabel = theme.iptc_second_label || theme.iptc_label_2nd || '-';
                const decisionSource = theme.decision_source || '';
                
                // GÃ¼ven skoru rengini belirle
                let confidenceColor = '#4CAF50'; // yeÅŸil (yÃ¼ksek gÃ¼ven)
                if (confidenceVal < 0.3) confidenceColor = '#F44336'; // kÄ±rmÄ±zÄ± (dÃ¼ÅŸÃ¼k gÃ¼ven)
                else if (confidenceVal < 0.5) confidenceColor = '#FF9800'; // turuncu (orta gÃ¼ven)
                
                // Decision source badge
                let sourceBadge = '';
                if (decisionSource === 'agreement') {
                    sourceBadge = '<span style="background: #4CAF50; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7em; margin-left: 5px;">âœ“ Uyum</span>';
                } else if (decisionSource === 'rule_preferred') {
                    sourceBadge = '<span style="background: #2196F3; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7em; margin-left: 5px;">Kural</span>';
                } else if (decisionSource.startsWith('nn_')) {
                    sourceBadge = '<span style="background: #9C27B0; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7em; margin-left: 5px;">NN</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace; font-weight: 600; font-size: 0.9em;">${theme.theme_code}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-transform: capitalize;">
                        <span style="background: #e8f5e9; color: #4CAF50; padding: 4px 8px; border-radius: 4px; font-size: 0.85em;">
                            ${iptcLabel}
                        </span>
                        ${sourceBadge}
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                        <span style="background: #e3f2fd; color: #2196F3; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                            %${similarity}
                        </span>
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                        <span style="background: ${confidenceColor}20; color: ${confidenceColor}; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                            %${confidence}
                        </span>
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; color: #999; font-size: 0.85em; text-transform: capitalize;">
                        ${secondLabel}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Progress container'Ä± gÃ¶ster
        function showIPTCProgress() {
            const container = document.getElementById('iptc-progress-container');
            if (container) {
                container.style.display = 'block';
                // TÃ¼m adÄ±mlarÄ± sÄ±fÄ±rla
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.style.color = '#666';
                    const icon = step.querySelector('.step-icon');
                    if (icon) {
                        icon.style.background = '#6b7280';
                        icon.textContent = step.dataset.step;
                    }
                });
                // Progress bar sÄ±fÄ±rla
                const bar = document.getElementById('iptc-progress-bar');
                if (bar) bar.style.width = '0%';
            }
        }
        
        // Progress container'Ä± gizle
        function hideIPTCProgress() {
            const container = document.getElementById('iptc-progress-container');
            if (container) {
                container.style.display = 'none';
            }
        }
        
        // Progress adÄ±mÄ±nÄ± gÃ¼ncelle
        function updateIPTCProgressStep(stepNumber, status = 'active') {
            const step = document.querySelector(`.progress-step[data-step="${stepNumber}"]`);
            if (!step) return;
            
            const icon = step.querySelector('.step-icon');
            const progressBar = document.getElementById('iptc-progress-bar');
            const progressText = document.getElementById('iptc-progress-text');
            
            if (status === 'active') {
                step.style.color = '#667eea';
                step.style.fontWeight = '600';
                if (icon) {
                    icon.style.background = '#667eea';
                    icon.innerHTML = '<span class="loading-spinner" style="width: 14px; height: 14px; border-width: 2px;"></span>';
                }
                // Progress text gÃ¼ncelle
                const stepText = step.querySelector('.step-text');
                if (progressText && stepText) {
                    progressText.textContent = stepText.textContent;
                }
            } else if (status === 'completed') {
                step.style.color = '#10b981';
                step.style.fontWeight = '500';
                if (icon) {
                    icon.style.background = '#10b981';
                    icon.textContent = 'âœ“';
                }
            } else if (status === 'error') {
                step.style.color = '#ef4444';
                if (icon) {
                    icon.style.background = '#ef4444';
                    icon.textContent = 'âœ—';
                }
            }
            
            // Progress bar gÃ¼ncelle (5 adÄ±m)
            if (progressBar && status === 'completed') {
                progressBar.style.width = `${(stepNumber / 5) * 100}%`;
            }
        }
        
        // IPTC Status mesajÄ± gÃ¶ster
        function showIPTCMappingStatus(message, type = 'info') {
            const el = document.getElementById('iptc-mapping-status');
            el.textContent = message;
            el.className = `status-message ${type}`;
            el.style.display = 'block';
        }
        
        // ==================== GDELT CHARTS FONKSÄ°YONLARI ====================
        
        let gdeltChartInstances = [];
        let clusteringChartInstances = [];
        
        // IPTC renk haritasÄ± (global)
        const iptcColors = {
            'economy, business and finance': '#FF9800',
            'conflict, war and peace': '#F44336',
            'politics and government': '#2196F3',
            'health': '#4CAF50',
            'education': '#9C27B0',
            'disaster, accident and emergency incident': '#E91E63',
            'environment': '#8BC34A',
            'society': '#607D8B',
            'crime, law and justice': '#3F51B5',
            'science and technology': '#009688',
            'labour': '#FFC107',
            'lifestyle and leisure': '#00BCD4',
            'religion': '#795548',
            'human interest': '#FF5722',
            'sport': '#CDDC39',
            'arts, culture, entertainment and media': '#673AB7',
            'weather': '#03A9F4'
        };
        
        // GDELT & IPTC Grafikleri OluÅŸtur
        function generateGDELTCharts() {
            // gdeltTotalDocs kullan (yeni CSV sistemi)
            if (!gdeltTotalDocs || gdeltTotalDocs.length === 0) {
                showStatus('âŒ Grafik oluÅŸturmak iÃ§in Ã¶nce GDELT Tema sekmesinden CSV verilerini yÃ¼kleyin!', 'error');
                return;
            }
            
            // Mevcut chart'larÄ± temizle
            gdeltChartInstances.forEach(chart => {
                if (chart) chart.destroy();
            });
            gdeltChartInstances = [];
            
            showStatus('ğŸ“Š GDELT grafikleri oluÅŸturuluyor...', 'info');
            
            // 1. IPTC Kategori DaÄŸÄ±lÄ±mÄ±
            createIPTCDistributionChart();
            
            // 2. Ãœlke BazlÄ± Tema Hacmi
            createCountryThemeChart();
            
            // 3. En YÃ¼ksek Hacimli Temalar
            createTopThemesChart();
            
            // 4. IPTC Benzerlik SkorlarÄ±
            createIPTCSimilarityChart();
            
            showStatus('âœ… GDELT grafikleri oluÅŸturuldu!', 'success');
        }
        
        // IPTC Kategori DaÄŸÄ±lÄ±mÄ± (Bar Chart)
        function createIPTCDistributionChart() {
            const canvas = document.getElementById('iptc-distribution-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // IPTC kategorilerine gÃ¶re toplam dokÃ¼man hesapla
            const iptcTotals = {};
            gdeltTotalDocs.forEach(item => {
                const iptc = getIPTCCategory(item.theme_code);
                if (iptc) {
                    iptcTotals[iptc] = (iptcTotals[iptc] || 0) + (item.total_docs || 0);
                }
            });
            
            // SÄ±rala ve en yÃ¼ksek 10'u al
            const sorted = Object.entries(iptcTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const labels = sorted.map(([cat]) => cat.split(',')[0].trim()); // KÄ±sa isim
            const data = sorted.map(([, val]) => val);
            const colors = sorted.map(([cat]) => iptcColors[cat] || '#999');
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Toplam DokÃ¼man SayÄ±sÄ±',
                        data: data,
                        backgroundColor: colors.map(c => c + 'CC'),
                        borderColor: colors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'IPTC Kategori BazlÄ± DokÃ¼man DaÄŸÄ±lÄ±mÄ±',
                            font: { size: 14 }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'DokÃ¼man SayÄ±sÄ±' } },
                        x: { 
                            ticks: { maxRotation: 45, minRotation: 45 },
                            title: { display: true, text: 'IPTC Kategorisi' }
                        }
                    }
                }
            });
            gdeltChartInstances.push(chart);
        }
        
        // Ãœlke BazlÄ± Tema Hacmi (Grouped Bar)
        function createCountryThemeChart() {
            const canvas = document.getElementById('country-theme-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Ãœlkelere gÃ¶re grupla
            const countryTotals = {};
            gdeltTotalDocs.forEach(item => {
                const country = item.country || 'Unknown';
                countryTotals[country] = (countryTotals[country] || 0) + (item.total_docs || 0);
            });
            
            // En yÃ¼ksek 15 Ã¼lkeyi al
            const sorted = Object.entries(countryTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const labels = sorted.map(([country]) => country);
            const data = sorted.map(([, val]) => val);
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Toplam DokÃ¼man',
                        data: data,
                        backgroundColor: 'rgba(33, 150, 243, 0.7)',
                        borderColor: 'rgba(33, 150, 243, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ãœlke BazlÄ± Toplam Tema Hacmi',
                            font: { size: 14 }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true, title: { display: true, text: 'Toplam DokÃ¼man' } },
                        y: { title: { display: true, text: 'Ãœlke' } }
                    }
                }
            });
            gdeltChartInstances.push(chart);
        }
        
        // En YÃ¼ksek Hacimli Temalar (Horizontal Bar)
        function createTopThemesChart() {
            const canvas = document.getElementById('top-themes-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Temalara gÃ¶re grupla
            const themeTotals = {};
            gdeltTotalDocs.forEach(item => {
                const theme = item.theme_code || 'Unknown';
                themeTotals[theme] = (themeTotals[theme] || 0) + (item.total_docs || 0);
            });
            
            // En yÃ¼ksek 15 temayÄ± al
            const sorted = Object.entries(themeTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const labels = sorted.map(([theme]) => theme);
            const data = sorted.map(([, val]) => val);
            
            // Her tema iÃ§in IPTC rengini bul
            const colors = labels.map(theme => {
                const iptc = getIPTCCategory(theme);
                return iptc ? (iptcColors[iptc] || '#666') : '#999';
            });
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Toplam DokÃ¼man',
                        data: data,
                        backgroundColor: colors.map(c => c + 'BB'),
                        borderColor: colors,
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'En YÃ¼ksek Hacimli 15 GDELT Tema',
                            font: { size: 14 }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true, title: { display: true, text: 'Toplam DokÃ¼man' } },
                        y: { title: { display: true, text: 'GDELT Tema Kodu' } }
                    }
                }
            });
            gdeltChartInstances.push(chart);
        }
        
        // IPTC Benzerlik SkorlarÄ± (Radar veya Bar)
        function createIPTCSimilarityChart() {
            const canvas = document.getElementById('iptc-similarity-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // IPTC eÅŸleÅŸtirme sonuÃ§larÄ±ndan benzerlik skorlarÄ±nÄ± al
            let similarities = [];
            
            if (iptcMappingResults && iptcMappingResults.themes) {
                // EÅŸleÅŸtirme varsa benzerlik skorlarÄ±nÄ± kullan (themes dizisinden)
                const iptcAvg = {};
                iptcMappingResults.themes.forEach(t => {
                    const cat = t.iptc_final_label || t.iptc_label;
                    if (cat) {
                        if (!iptcAvg[cat]) iptcAvg[cat] = { sum: 0, count: 0 };
                        // nn_score veya similarity kullan (0-1 arasÄ± deÄŸerler)
                        const sim = t.nn_score || t.iptc_similarity || t.similarity || 0;
                        iptcAvg[cat].sum += sim;
                        iptcAvg[cat].count++;
                    }
                });
                
                similarities = Object.entries(iptcAvg)
                    .map(([cat, data]) => ({
                        category: cat,
                        similarity: data.count > 0 ? data.sum / data.count : 0
                    }))
                    .sort((a, b) => b.similarity - a.similarity);
            } else {
                // EÅŸleÅŸtirme yoksa tema sayÄ±sÄ±na gÃ¶re gÃ¶ster
                const iptcCounts = {};
                gdeltTotalDocs.forEach(item => {
                    const iptc = getIPTCCategory(item.theme_code);
                    if (iptc) {
                        if (!iptcCounts[iptc]) iptcCounts[iptc] = new Set();
                        iptcCounts[iptc].add(item.theme_code);
                    }
                });
                
                similarities = Object.entries(iptcCounts)
                    .map(([cat, themes]) => ({
                        category: cat,
                        similarity: themes.size // Tema sayÄ±sÄ± olarak
                    }))
                    .sort((a, b) => b.similarity - a.similarity);
            }
            
            if (similarities.length === 0) {
                return;
            }
            
            const hasMapping = iptcMappingResults && iptcMappingResults.themes;
            const labels = similarities.slice(0, 10).map(s => s.category.split(',')[0].trim());
            // Benzerlik 0-1 arasÄ±, yÃ¼zde olarak gÃ¶ster (sayÄ±sal deÄŸer olmalÄ±, string deÄŸil)
            const data = similarities.slice(0, 10).map(s => 
                hasMapping ? parseFloat((s.similarity * 100).toFixed(1)) : s.similarity
            );
            const colors = similarities.slice(0, 10).map(s => iptcColors[s.category] || '#999');
            
            const chartTitle = hasMapping 
                ? 'IPTC Kategorileri - Ortalama Benzerlik Skoru (%)'
                : 'IPTC Kategorileri - EÅŸleÅŸen Tema SayÄ±sÄ±';
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: hasMapping ? 'Benzerlik (%)' : 'Tema SayÄ±sÄ±',
                        data: data,
                        backgroundColor: colors.map(c => c + 'AA'),
                        borderColor: colors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: chartTitle,
                            font: { size: 14 }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            title: { display: true, text: hasMapping ? 'Benzerlik (%)' : 'Tema SayÄ±sÄ±' },
                            max: hasMapping ? 100 : undefined
                        },
                        x: { 
                            ticks: { maxRotation: 45, minRotation: 45 },
                            title: { display: true, text: 'IPTC Kategorisi' }
                        }
                    }
                }
            });
            gdeltChartInstances.push(chart);
        }
        
        // ==================== KÃœMELEME GRAFÄ°K FONKSÄ°YONLARI ====================
        
        // KÃ¼meleme Grafikleri OluÅŸtur
        function generateClusteringCharts() {
            if (!iptcMappingResults || !iptcMappingResults.themes) {
                showStatus('âŒ KÃ¼meleme grafikleri iÃ§in Ã¶nce KÃ¼meleme sekmesinden IPTC eÅŸleÅŸtirme Ã§alÄ±ÅŸtÄ±rÄ±n!', 'error');
                return;
            }
            
            // Mevcut kÃ¼meleme chart'larÄ±nÄ± temizle
            clusteringChartInstances.forEach(chart => {
                if (chart) chart.destroy();
            });
            clusteringChartInstances = [];
            
            showStatus('ğŸ¤– KÃ¼meleme grafikleri oluÅŸturuluyor...', 'info');
            
            // 1. t-SNE Scatter Plot (simÃ¼le edilmiÅŸ)
            createTSNEScatterChart();
            
            // 2. IPTC Kategori Tema SayÄ±sÄ±
            createIPTCThemeCountChart();
            
            // 3. Benzerlik Skor DaÄŸÄ±lÄ±mÄ± (Histogram)
            createSimilarityHistogramChart();
            
            // 4. EÅŸleÅŸtirme YÃ¶ntemi DaÄŸÄ±lÄ±mÄ± (Pie)
            createMethodPieChart();
            
            showStatus('âœ… KÃ¼meleme grafikleri oluÅŸturuldu!', 'success');
        }
        
        // t-SNE Scatter Plot - Genel helper fonksiyon
        function createTSNEScatterChartBase(canvasId, data, titlePrefix, chartColor) {
            const canvas = document.getElementById(canvasId);
            if (!canvas || !data || !data.themes) return null;
            
            const ctx = canvas.getContext('2d');
            
            // Her IPTC kategorisi iÃ§in temalarÄ± grupla
            const datasets = [];
            const categoryThemes = {};
            
            // GerÃ§ek t-SNE koordinatlarÄ± var mÄ± kontrol et
            const hasRealCoords = data.themes.some(t => 
                typeof t.tsne_x === 'number' && typeof t.tsne_y === 'number'
            );
            
            data.themes.forEach(theme => {
                const cat = theme.iptc_final_label || theme.iptc_label || 'DiÄŸer';
                if (!categoryThemes[cat]) categoryThemes[cat] = [];
                categoryThemes[cat].push(theme);
            });
            
            // Her kategori iÃ§in scatter data oluÅŸtur
            Object.entries(categoryThemes).forEach(([cat, themes]) => {
                const color = iptcColors[cat] || '#999';
                
                // GerÃ§ek t-SNE koordinatlarÄ±nÄ± kullan (JSON'dan)
                const scatterData = themes.map(theme => {
                    // tsne_x ve tsne_y Python tarafÄ±ndan hesaplanmÄ±ÅŸ koordinatlar
                    let x = theme.tsne_x;
                    let y = theme.tsne_y;
                    
                    // Koordinat yoksa veya geÃ§ersizse fallback (eski veriler iÃ§in)
                    if (typeof x !== 'number' || typeof y !== 'number' || isNaN(x) || isNaN(y)) {
                        // Benzerlik skoruna dayalÄ± fallback (gerÃ§ek olmayan)
                        const sim = theme.nn_score || theme.similarity || 0.5;
                        x = 50 + (Math.random() - 0.5) * 60;
                        y = sim * 80 + 10 + (Math.random() - 0.5) * 20;
                    }
                    
                    return {
                        x: x,
                        y: y,
                        label: theme.theme_code,
                        similarity: theme.nn_score || theme.similarity || 0
                    };
                });
                
                datasets.push({
                    label: cat.split(',')[0],
                    data: scatterData,
                    backgroundColor: color + 'BB',
                    borderColor: color,
                    borderWidth: 1,
                    pointRadius: 5,
                    pointHoverRadius: 8
                });
            });
            
            // Koordinat aralÄ±ÄŸÄ±nÄ± hesapla (gerÃ§ek koordinatlar iÃ§in)
            let minX = 0, maxX = 100, minY = 0, maxY = 100;
            if (hasRealCoords) {
                const allX = data.themes.map(t => t.tsne_x).filter(v => typeof v === 'number');
                const allY = data.themes.map(t => t.tsne_y).filter(v => typeof v === 'number');
                if (allX.length > 0 && allY.length > 0) {
                    minX = Math.floor(Math.min(...allX) - 2);
                    maxX = Math.ceil(Math.max(...allX) + 2);
                    minY = Math.floor(Math.min(...allY) - 2);
                    maxY = Math.ceil(Math.max(...allY) + 2);
                }
            }
            
            const chartTitle = hasRealCoords 
                ? `${titlePrefix} t-SNE 2D Tema DaÄŸÄ±lÄ±mÄ±`
                : `${titlePrefix} (SimÃ¼le - Python Ã§alÄ±ÅŸtÄ±rÄ±n)`;
            
            const chart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: chartTitle,
                            font: { size: 14 },
                            color: hasRealCoords ? '#333' : '#FF9800'
                        },
                        legend: {
                            display: true,
                            position: 'right',
                            labels: { boxWidth: 12, font: { size: 9 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const d = context.raw;
                                    return `${d.label} (sim: ${(d.similarity * 100).toFixed(0)}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            title: { display: true, text: 't-SNE Boyut 1' }, 
                            min: minX, 
                            max: maxX 
                        },
                        y: { 
                            title: { display: true, text: 't-SNE Boyut 2' }, 
                            min: minY, 
                            max: maxY 
                        }
                    }
                }
            });
            
            return chart;
        }
        
        // V1 iÃ§in t-SNE grafiÄŸi
        function createTSNEScatterChartV1() {
            if (!iptcMappingResultsV1) return;
            
            // Ã–nce eski grafiÄŸi temizle
            const idx = clusteringChartInstances.findIndex(c => c.canvas && c.canvas.id === 'tsne-scatter-chart-v1');
            if (idx > -1) {
                clusteringChartInstances[idx].destroy();
                clusteringChartInstances.splice(idx, 1);
            }
            
            const chart = createTSNEScatterChartBase(
                'tsne-scatter-chart-v1', 
                iptcMappingResultsV1, 
                'V1 (Embedding)',
                '#2196F3'
            );
            if (chart) clusteringChartInstances.push(chart);
        }
        
        // V2 iÃ§in t-SNE grafiÄŸi
        function createTSNEScatterChartV2() {
            if (!iptcMappingResultsV2) return;
            
            // Ã–nce eski grafiÄŸi temizle
            const idx = clusteringChartInstances.findIndex(c => c.canvas && c.canvas.id === 'tsne-scatter-chart-v2');
            if (idx > -1) {
                clusteringChartInstances[idx].destroy();
                clusteringChartInstances.splice(idx, 1);
            }
            
            const chart = createTSNEScatterChartBase(
                'tsne-scatter-chart-v2', 
                iptcMappingResultsV2, 
                'V2 (Fusion)',
                '#4CAF50'
            );
            if (chart) clusteringChartInstances.push(chart);
        }
        
        // Her iki t-SNE grafiÄŸini de Ã§iz
        function createBothTSNEScatterCharts() {
            createTSNEScatterChartV1();
            createTSNEScatterChartV2();
        }
        
        // Eski tek grafik fonksiyonu (uyumluluk iÃ§in)
        function createTSNEScatterChart() {
            // ArtÄ±k aktif sonuca gÃ¶re Ã§alÄ±ÅŸÄ±r
            if (activeMapping === 'v1' && iptcMappingResultsV1) {
                createTSNEScatterChartV1();
            } else if (iptcMappingResultsV2) {
                createTSNEScatterChartV2();
            }
        }
        
        // IPTC Kategori Tema SayÄ±sÄ±
        function createIPTCThemeCountChart() {
            const canvas = document.getElementById('iptc-theme-count-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Kategori bazÄ±nda tema sayÄ±sÄ±
            const categoryCounts = {};
            iptcMappingResults.themes.forEach(theme => {
                const cat = theme.iptc_final_label || theme.iptc_label || 'DiÄŸer';
                categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
            });
            
            const sorted = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1]);
            
            const labels = sorted.map(([cat]) => cat.split(',')[0]);
            const data = sorted.map(([, count]) => count);
            const colors = sorted.map(([cat]) => iptcColors[cat] || '#999');
            
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.map(c => c + 'CC'),
                        borderColor: colors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `IPTC Kategorilerine DaÄŸÄ±lan ${iptcMappingResults.themes.length} Tema`,
                            font: { size: 14 }
                        },
                        legend: {
                            display: true,
                            position: 'right',
                            labels: { boxWidth: 12, font: { size: 9 } }
                        }
                    }
                }
            });
            clusteringChartInstances.push(chart);
        }
        
        // Benzerlik Skor DaÄŸÄ±lÄ±mÄ± (Histogram)
        function createSimilarityHistogramChart() {
            const canvas = document.getElementById('similarity-histogram-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Benzerlik skorlarÄ±nÄ± histogram bins'e grupla
            const bins = [0, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0];
            const binLabels = ['<30%', '30-40%', '40-50%', '50-60%', '60-70%', '70-80%', '80-90%', '90-100%'];
            const binCounts = new Array(binLabels.length).fill(0);
            
            iptcMappingResults.themes.forEach(theme => {
                // nn_score veya similarity deÄŸerini al (0-1 arasÄ±)
                const sim = theme.nn_score || theme.iptc_similarity || theme.similarity || 0;
                
                // Bins'e yerleÅŸtir
                if (sim < 0.3) {
                    binCounts[0]++;
                } else if (sim < 0.4) {
                    binCounts[1]++;
                } else if (sim < 0.5) {
                    binCounts[2]++;
                } else if (sim < 0.6) {
                    binCounts[3]++;
                } else if (sim < 0.7) {
                    binCounts[4]++;
                } else if (sim < 0.8) {
                    binCounts[5]++;
                } else if (sim < 0.9) {
                    binCounts[6]++;
                } else {
                    binCounts[7]++;
                }
            });
            
            // Renk gradyanÄ± (kÃ¶tÃ¼den iyiye)
            const binColors = [
                '#f44336', '#ff5722', '#ff9800', '#ffc107', 
                '#cddc39', '#8bc34a', '#4caf50', '#2e7d32'
            ];
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Tema SayÄ±sÄ±',
                        data: binCounts,
                        backgroundColor: binColors.map(c => c + 'CC'),
                        borderColor: binColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Benzerlik Skoru DaÄŸÄ±lÄ±mÄ±',
                            font: { size: 14 }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Tema SayÄ±sÄ±' } },
                        x: { title: { display: true, text: 'Benzerlik Skoru' } }
                    }
                }
            });
            clusteringChartInstances.push(chart);
        }
        
        // EÅŸleÅŸtirme YÃ¶ntemi DaÄŸÄ±lÄ±mÄ± (Pie)
        function createMethodPieChart() {
            const canvas = document.getElementById('method-pie-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // EÅŸleÅŸtirme yÃ¶ntemlerine gÃ¶re say
            const methodCounts = {
                'Kural TabanlÄ±': 0,
                'Embedding NN': 0,
                'Vargo Mapping': 0,
                'Prefix Match': 0,
                'Bilinmeyen': 0
            };
            
            iptcMappingResults.themes.forEach(theme => {
                const method = theme.match_method || theme.method || '';
                if (method.toLowerCase().includes('rule') || method.toLowerCase().includes('kural')) {
                    methodCounts['Kural TabanlÄ±']++;
                } else if (method.toLowerCase().includes('embed') || method.toLowerCase().includes('nn')) {
                    methodCounts['Embedding NN']++;
                } else if (method.toLowerCase().includes('vargo')) {
                    methodCounts['Vargo Mapping']++;
                } else if (method.toLowerCase().includes('prefix')) {
                    methodCounts['Prefix Match']++;
                } else {
                    methodCounts['Bilinmeyen']++;
                }
            });
            
            // SÄ±fÄ±r olmayanlarÄ± filtrele
            const filtered = Object.entries(methodCounts).filter(([, count]) => count > 0);
            const labels = filtered.map(([method]) => method);
            const data = filtered.map(([, count]) => count);
            const colors = ['#2196F3', '#4CAF50', '#FF9800', '#9C27B0', '#607D8B'];
            
            const chart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length).map(c => c + 'CC'),
                        borderColor: colors.slice(0, labels.length),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'EÅŸleÅŸtirme YÃ¶ntemi DaÄŸÄ±lÄ±mÄ±',
                            font: { size: 14 }
                        },
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                }
            });
            clusteringChartInstances.push(chart);
        }
        
        // ==================== IPTC MAPPING FONKSÄ°YONLARI SONU ====================
        
        // ==================== GDELT TEMA ANALÄ°ZÄ° FONKSÄ°YONLARI ====================
        
        let gdeltTotalDocs = [];      // gdelt_top15_themes_by_country_2022_2024.csv (country, theme_code, total_docs) - BigQuery QUALIFY top 15
        let gdeltMonthlyQuality = []; // gdelt_monthly_quality_metrics.csv (country, theme_code, months_total, months_ok, median_docs) - BigQuery aggregated
        let gdeltMonthlyDetail = [];  // gdelt_monthly_docs_per_theme_country_2022_2024.csv (ym, country, theme_code, n_docs) - BigQuery monthly counts
        let trendAnalysisData = [];   // gdelt_theme_trend_analysis_2022_2024.csv (country, theme_code, trend_slope, trend_category) - BigQuery trend analysis
        let gdeltDataLoaded = false;
        
        // IPTC Media Topics - Resmi 17 Ãœst DÃ¼zey Kategori
        const IPTC_CATEGORIES = {
            'arts, culture, entertainment and media': ['MEDIA', 'CULTURE'],
            'conflict, war and peace': ['CRISISLEX', 'ARMEDCONFLICT', 'KILL', 'TERROR', 'SECURITY', 'MILITARY'],
            'crime, law and justice': ['CRIME', 'JUSTICE', 'LAW'],
            'disaster, accident and emergency incident': ['MANMADE', 'DISASTER', 'NATURAL'],
            'economy, business and finance': ['ECON', 'EPU', 'EPU_ECONOMY', 'TAX', 'AGRICULTURE'],
            'education': ['EDUCATION'],
            'environment': ['ENV', 'CLIMATE'],
            'health': ['HEALTH', 'MEDICAL', 'GENERAL_HEALTH'],
            'human interest': ['AFFECT', 'GENERAL'],
            'labour': ['LABOR', 'EMPLOYMENT', 'WORKFORCE'],
            'lifestyle and leisure': ['TOURISM', 'TRAVEL', 'LEISURE'],
            'politics and government': ['LEADER', 'ELECTION', 'DEMOCRACY', 'LEGISLATION', 'GOVERNMENT', 'GENERAL_GOVERNMENT', 'GOV', 'UNGP'],
            'religion': ['RELIGION'],
            'science and technology': ['SCIENCE', 'TECHNOLOGY', 'RESEARCH'],
            'society': ['SOC', 'SOCIAL', 'COMMUNITY'],
            'sport': ['SPORT', 'SPORTS'],
            'weather': ['WEATHER', 'CLIMATE_WEATHER']
        };
        
        // TÃ¼m kullanÄ±labilir GDELT temalarÄ±
        const USABLE_CATEGORIES = [
            // economy, business and finance
            'ECON', 'EPU', 'EPU_ECONOMY', 'TAX', 'AGRICULTURE',
            // conflict, war and peace
            'CRISISLEX', 'ARMEDCONFLICT', 'KILL', 'TERROR', 'SECURITY', 'MILITARY',
            // politics and government
            'LEADER', 'ELECTION', 'DEMOCRACY', 'LEGISLATION', 'GOVERNMENT', 'GENERAL_GOVERNMENT', 'GOV', 'UNGP',
            // health
            'HEALTH', 'MEDICAL', 'GENERAL_HEALTH',
            // education
            'EDUCATION',
            // lifestyle and leisure
            'TOURISM', 'TRAVEL', 'LEISURE',
            // disaster, accident
            'MANMADE', 'DISASTER', 'NATURAL',
            // environment
            'ENV', 'CLIMATE',
            // arts, culture, entertainment
            'MEDIA', 'CULTURE',
            // society
            'SOC', 'SOCIAL',
            // human interest
            'AFFECT', 'GENERAL',
            // religion
            'RELIGION',
            // science and technology
            'SCIENCE', 'TECHNOLOGY'
        ];
        
        const METADATA_PREFIXES = ['TAX_', 'WB_', 'USPEC_', 'UNGP_', 'SOC_', 'SLFID_'];
        
        // Tema iÃ§in IPTC kategorisi bul
        function getIPTCCategory(themeCode) {
            for (const [iptcLabel, themes] of Object.entries(IPTC_CATEGORIES)) {
                if (themes.includes(themeCode)) {
                    return iptcLabel;
                }
            }
            return null;
        }
        
        // Tema tipini belirle (IPTC kategorili veya metadata)
        function getThemeType(themeCode) {
            // Metadata kontrolÃ¼ (prefix ile baÅŸlayanlar)
            for (const prefix of METADATA_PREFIXES) {
                if (themeCode.startsWith(prefix)) {
                    return 'metadata';
                }
            }
            // IPTC kategorisinde mi?
            const iptc = getIPTCCategory(themeCode);
            if (iptc) {
                return 'iptc';  // IPTC eÅŸleÅŸmiÅŸ kategori
            }
            // KullanÄ±labilir kategori listesinde mi?
            if (USABLE_CATEGORIES.includes(themeCode)) {
                return 'category';
            }
            // VarsayÄ±lan: DiÄŸer
            return 'other';
        }
        
        // CSV parse (basit)
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((h, idx) => {
                    let val = (values[idx] || '').trim();
                    // SayÄ±sal deÄŸerleri dÃ¶nÃ¼ÅŸtÃ¼r
                    if (['total_docs', 'months_total', 'months_ok', 'min_docs', 'median_docs', 'n_docs'].includes(h)) {
                        row[h] = parseInt(val) || 0;
                    } else {
                        row[h] = val;
                    }
                });
                data.push(row);
            }
            return data;
        }
        
        // GDELT Status mesajÄ±
        function showGDELTStatus(message, type = 'info') {
            const el = document.getElementById('gdelt-status');
            el.textContent = message;
            el.className = `status-message ${type}`;
            el.style.display = 'block';
        }
        
        // CSV verilerini yÃ¼kle
        async function loadGDELTData() {
            const btn = document.getElementById('load-gdelt-data-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span>YÃ¼kleniyor...';
            
            showGDELTStatus('ğŸ“¥ CSV dosyalarÄ± yÃ¼kleniyor...', 'info');
            
            try {
                // Tablo-1: Top 15 tema baÅŸÄ±na toplam docs (BigQuery sorgusu: QUALIFY ROW_NUMBER() <= 15)
                const resp1 = await fetch('gdelt_top15_themes_by_country_2022_2024.csv');
                if (!resp1.ok) throw new Error('Top 15 tema CSV bulunamadÄ±');
                const text1 = await resp1.text();
                gdeltTotalDocs = parseCSV(text1);
                
                // Tablo-2: AylÄ±k kalite metrikleri (BigQuery sorgusu: months_total, months_ok, median_docs)
                const resp2 = await fetch('gdelt_monthly_quality_metrics.csv');
                if (!resp2.ok) throw new Error('AylÄ±k kalite CSV bulunamadÄ±');
                const text2 = await resp2.text();
                gdeltMonthlyQuality = parseCSV(text2);
                
                // Tablo-3: AylÄ±k detay verisi (BigQuery sorgusu: ym, country, theme_code, n_docs)
                const resp3 = await fetch('gdelt_monthly_docs_per_theme_country_2022_2024.csv');
                if (!resp3.ok) throw new Error('AylÄ±k detay CSV bulunamadÄ±');
                const text3 = await resp3.text();
                gdeltMonthlyDetail = parseCSV(text3);
                
                // Tablo-4: Trend analiz verisi (BigQuery sorgusu: aylÄ±k trend slope, varyans, ortalama)
                try {
                    const resp4 = await fetch('gdelt_theme_trend_analysis_2022_2024.csv');
                    if (resp4.ok) {
                        const text4 = await resp4.text();
                        gdeltTrendAnalysis = parseCSV(text4);
                    }
                } catch (e) {
                    console.log('Trend analiz dosyasÄ± yÃ¼klenemedi (opsiyonel)');
                }
                
                // Trend verisini global deÄŸiÅŸkene ata
                trendAnalysisData = gdeltTrendAnalysis;
                
                // Global deÄŸiÅŸkenleri doldur
                totalDocsData = gdeltTotalDocs;
                monthlyQualityData = gdeltMonthlyQuality;
                monthlyDetailData = gdeltMonthlyDetail;
                
                gdeltDataLoaded = true;
                
                // TablolarÄ± gÃ¼ncelle
                updateTotalDocsTable();
                updateMonthlyQualityTable();
                updateMonthlyDetailTable();  // Tablo-3
                updateTrendAnalysisTable();  // Tablo-4
                
                // ButonlarÄ± aktif et
                document.getElementById('analyze-themes-btn').disabled = false;
                document.getElementById('generate-matrix-btn').disabled = false;
                // export-gdelt-btn kaldÄ±rÄ±ldÄ± - yeni yapÄ±da AdÄ±m C'de export var
                
                showGDELTStatus(`âœ… Veriler yÃ¼klendi! Top 15 Tema: ${gdeltTotalDocs.length}, Kalite Metrikleri: ${gdeltMonthlyQuality.length}, AylÄ±k Detay: ${gdeltMonthlyDetail.length}, Trend Analiz: ${gdeltTrendAnalysis.length} satÄ±r`, 'success');
                
            } catch (error) {
                showGDELTStatus(`âŒ YÃ¼kleme hatasÄ±: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“¥ CSV Verilerini YÃ¼kle';
            }
        }
        
        // Tablo-1'i gÃ¼ncelle (total_docs)
        function updateTotalDocsTable() {
            const tbody = document.getElementById('total-docs-tbody');
            const countryFilter = document.getElementById('gdelt-country-select').value;
            
            if (!gdeltDataLoaded || gdeltTotalDocs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi.</td></tr>';
                return;
            }
            
            // Filtrele
            let filtered = gdeltTotalDocs;
            if (countryFilter !== 'ALL') {
                filtered = gdeltTotalDocs.filter(d => d.country === countryFilter);
            }
            
            // SÄ±rala (total_docs'a gÃ¶re azalan)
            filtered.sort((a, b) => b.total_docs - a.total_docs);
            
            // Ä°lk 100 satÄ±r
            const toShow = filtered.slice(0, 100);
            
            // IPTC renk haritasÄ±
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'lifestyle and leisure': '#00BCD4',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'arts, culture, entertainment and media': '#673AB7',
                'society': '#607D8B',
                'human interest': '#FF5722',
                'religion': '#795548',
                'science and technology': '#009688',
                'crime, law and justice': '#3F51B5',
                'labour': '#FFC107',
                'sport': '#CDDC39',
                'weather': '#03A9F4'
            };
            
            tbody.innerHTML = '';
            toShow.forEach(row => {
                const iptcCategory = getIPTCCategory(row.theme_code);
                let iptcBadge = '';
                
                if (iptcCategory) {
                    const color = iptcColors[iptcCategory] || '#667eea';
                    const shortLabel = iptcCategory.split(',')[0]; // Ä°lk kÄ±smÄ± al
                    iptcBadge = `<span style="background: ${color}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; text-transform: capitalize;">${shortLabel}</span>`;
                } else {
                    iptcBadge = '<span style="background: #9e9e9e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75em;">DiÄŸer</span>';
                }
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${row.country}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace; font-weight: 600;">${row.theme_code}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; font-weight: 600;">${row.total_docs.toLocaleString()}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${iptcBadge}</td>
                `;
                tbody.appendChild(tr);
            });
            
            if (toShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px; color: #999;">Veri bulunamadÄ±</td></tr>';
            }
        }
        
        // Tablo-2'yi gÃ¼ncelle (monthly quality)
        function updateMonthlyQualityTable() {
            const tbody = document.getElementById('monthly-quality-tbody');
            const qualityFilter = document.getElementById('gdelt-quality-filter').value;
            
            if (!gdeltDataLoaded || gdeltMonthlyQuality.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi.</td></tr>';
                return;
            }
            
            // IPTC renk haritasÄ±
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'lifestyle and leisure': '#00BCD4',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'arts, culture, entertainment and media': '#673AB7',
                'society': '#607D8B',
                'human interest': '#FF5722',
                'religion': '#795548',
                'science and technology': '#009688',
                'crime, law and justice': '#3F51B5',
                'labour': '#FFC107',
                'sport': '#CDDC39',
                'weather': '#03A9F4'
            };
            
            // Oran hesapla ve filtrele
            let filtered = gdeltMonthlyQuality.map(row => {
                const ratio = row.months_total > 0 ? row.months_ok / row.months_total : 0;
                let decision = '';
                let decisionColor = '';
                
                if (ratio >= 0.7) {
                    decision = 'âœ… AylÄ±k';
                    decisionColor = '#4CAF50';
                } else if (ratio >= 0.4) {
                    decision = 'âš ï¸ Quarterly';
                    decisionColor = '#FF9800';
                } else {
                    decision = 'âŒ Ã‡Ä±kar';
                    decisionColor = '#f44336';
                }
                
                return { ...row, ratio, decision, decisionColor };
            });
            
            // Kalite filtresi
            if (qualityFilter === 'good') {
                filtered = filtered.filter(d => d.ratio >= 0.7);
            } else if (qualityFilter === 'marginal') {
                filtered = filtered.filter(d => d.ratio >= 0.4 && d.ratio < 0.7);
            } else if (qualityFilter === 'poor') {
                filtered = filtered.filter(d => d.ratio < 0.4);
            }
            
            // Sadece IPTC kategorisine sahip temalarÄ± gÃ¶ster
            filtered = filtered.filter(d => getIPTCCategory(d.theme_code) !== null);
            
            // SÄ±rala (ratio'ya gÃ¶re azalan)
            filtered.sort((a, b) => b.ratio - a.ratio || b.median_docs - a.median_docs);
            
            // Ä°lk 100
            const toShow = filtered.slice(0, 100);
            
            tbody.innerHTML = '';
            toShow.forEach(row => {
                const iptcCategory = getIPTCCategory(row.theme_code);
                const color = iptcColors[iptcCategory] || '#667eea';
                const shortLabel = iptcCategory ? iptcCategory.split(',')[0] : 'DiÄŸer';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${row.country}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace; font-weight: 600;">${row.theme_code}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">
                        <span style="background: ${color}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; text-transform: capitalize;">${shortLabel}</span>
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">${row.months_ok}/${row.months_total}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center; font-weight: 600;">${(row.ratio * 100).toFixed(0)}%</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center; color: ${row.decisionColor}; font-weight: 600;">${row.decision}</td>
                `;
                tbody.appendChild(tr);
            });
            
            if (toShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #999;">Filtreye uygun veri yok</td></tr>';
            }
        }
        
        // ==================== TABLO-3: AYLIK DETAY FONKSÄ°YONLARI ====================
        
        let monthlyDetailSortColumn = 'n_docs';
        let monthlyDetailSortAsc = false;
        
        // Tablo-3 tema dropdown'Ä±nÄ± doldur
        function populateThemeDropdown() {
            const select = document.getElementById('monthly-detail-theme');
            if (!select || gdeltMonthlyDetail.length === 0) return;
            
            // Mevcut seÃ§imi koru
            const currentValue = select.value;
            
            // Benzersiz temalarÄ± al
            const themes = [...new Set(gdeltMonthlyDetail.map(d => d.theme_code))].sort();
            
            select.innerHTML = '<option value="ALL">TÃ¼mÃ¼</option>';
            themes.forEach(theme => {
                const opt = document.createElement('option');
                opt.value = theme;
                opt.textContent = theme;
                select.appendChild(opt);
            });
            
            // Ã–nceki seÃ§imi geri yÃ¼kle
            if (currentValue && themes.includes(currentValue)) {
                select.value = currentValue;
            }
        }
        
        // Tablo-3'Ã¼ gÃ¼ncelle
        function updateMonthlyDetailTable() {
            const tbody = document.getElementById('monthly-detail-tbody');
            
            if (!gdeltDataLoaded || gdeltMonthlyDetail.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi. "CSV Verilerini YÃ¼kle" butonuna tÄ±klayÄ±n.</td></tr>';
                return;
            }
            
            // Tema dropdown'Ä±nÄ± doldur (ilk Ã§aÄŸrÄ±da)
            populateThemeDropdown();
            
            // Filtre deÄŸerlerini al
            const countryFilter = document.getElementById('monthly-detail-country').value;
            const themeFilter = document.getElementById('monthly-detail-theme').value;
            const yearFilter = document.getElementById('monthly-detail-year').value;
            const minDocs = parseInt(document.getElementById('monthly-detail-min-docs').value) || 0;
            
            // IPTC renk haritasÄ±
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'lifestyle and leisure': '#00BCD4',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'arts, culture, entertainment and media': '#673AB7',
                'society': '#607D8B',
                'human interest': '#FF5722',
                'religion': '#795548',
                'science and technology': '#009688',
                'crime, law and justice': '#3F51B5',
                'labour': '#FFC107',
                'sport': '#CDDC39',
                'weather': '#03A9F4'
            };
            
            // Filtreleme
            let filtered = gdeltMonthlyDetail.filter(row => {
                if (countryFilter !== 'ALL' && row.country !== countryFilter) return false;
                if (themeFilter !== 'ALL' && row.theme_code !== themeFilter) return false;
                if (yearFilter !== 'ALL' && !row.ym.startsWith(yearFilter)) return false;
                if (row.n_docs < minDocs) return false;
                return true;
            });
            
            // SÄ±ralama
            filtered.sort((a, b) => {
                let aVal = a[monthlyDetailSortColumn];
                let bVal = b[monthlyDetailSortColumn];
                
                // SayÄ±sal karÅŸÄ±laÅŸtÄ±rma
                if (monthlyDetailSortColumn === 'n_docs') {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                }
                
                if (monthlyDetailSortAsc) {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
            
            // Ä°statistikleri gÃ¼ncelle
            const totalDocs = filtered.reduce((sum, r) => sum + (r.n_docs || 0), 0);
            const uniqueThemes = new Set(filtered.map(r => r.theme_code)).size;
            const avgDocs = filtered.length > 0 ? Math.round(totalDocs / filtered.length) : 0;
            
            document.getElementById('detail-total-rows').textContent = filtered.length.toLocaleString();
            document.getElementById('detail-total-docs').textContent = totalDocs.toLocaleString();
            document.getElementById('detail-unique-themes').textContent = uniqueThemes;
            document.getElementById('detail-avg-docs').textContent = avgDocs.toLocaleString();
            document.getElementById('monthly-detail-count').textContent = `(${filtered.length.toLocaleString()} kayÄ±t gÃ¶steriliyor)`;
            
            // Ä°lk 500 satÄ±rÄ± gÃ¶ster (performans iÃ§in)
            const toShow = filtered.slice(0, 500);
            
            tbody.innerHTML = '';
            toShow.forEach(row => {
                const iptcCategory = getIPTCCategory(row.theme_code);
                const color = iptcColors[iptcCategory] || '#667eea';
                const shortLabel = iptcCategory ? iptcCategory.split(',')[0] : '-';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace;">${row.ym}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${row.country}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace; font-weight: 600;">${row.theme_code}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">
                        ${iptcCategory ? `<span style="background: ${color}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; text-transform: capitalize;">${shortLabel}</span>` : '<span style="color: #999;">-</span>'}
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; font-weight: 600;">${row.n_docs.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #999;">Filtreye uygun veri yok</td></tr>';
            } else if (filtered.length > 500) {
                const infoRow = document.createElement('tr');
                infoRow.innerHTML = `<td colspan="5" style="text-align: center; padding: 15px; background: #fff3e0; color: #FF5722;">
                    âš ï¸ ${filtered.length.toLocaleString()} kayÄ±ttan ilk 500 gÃ¶steriliyor. Daha fazlasÄ± iÃ§in filtreleri daraltÄ±n.
                </td>`;
                tbody.appendChild(infoRow);
            }
        }
        
        // Tablo-3 sÄ±ralama
        function sortMonthlyDetailTable(column) {
            if (monthlyDetailSortColumn === column) {
                monthlyDetailSortAsc = !monthlyDetailSortAsc;
            } else {
                monthlyDetailSortColumn = column;
                monthlyDetailSortAsc = column === 'n_docs' ? false : true;  // n_docs iÃ§in varsayÄ±lan desc
            }
            updateMonthlyDetailTable();
        }
        
        // ==================== TABLO-3 SONU ====================
        
        // ==================== TABLO-4: TREND ANALIZ FONKSÄ°YONLARI ====================
        
        let trendSortColumn = 'trend_slope';
        let trendSortAsc = false;
        
        // Trend tablosunu gÃ¼ncelle
        function updateTrendAnalysisTable() {
            const tbody = document.getElementById('trend-analysis-tbody');
            
            if (!gdeltDataLoaded || trendAnalysisData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 30px; color: #999;">CSV yÃ¼klenmedi. "CSV Verilerini YÃ¼kle" butonuna tÄ±klayÄ±n.</td></tr>';
                return;
            }
            
            // Filtre deÄŸerlerini al
            const categoryFilter = document.getElementById('trend-category-filter').value;
            const minSlope = parseFloat(document.getElementById('trend-min-slope').value) || -Infinity;
            const maxSlope = parseFloat(document.getElementById('trend-max-slope').value) || Infinity;
            
            // Filtreleme
            let filtered = trendAnalysisData.filter(row => {
                const slope = parseFloat(row.trend_slope) || 0;
                if (slope < minSlope || slope > maxSlope) return false;
                if (categoryFilter !== 'ALL' && row.trend_category !== categoryFilter) return false;
                return true;
            });
            
            // Ä°statistikleri hesapla
            const totalThemes = filtered.length;
            const artanCount = filtered.filter(r => r.trend_category === 'Artan').length;
            const azalanCount = filtered.filter(r => r.trend_category === 'Azalan').length;
            const stabilCount = filtered.filter(r => r.trend_category === 'Stabil').length;
            
            // Ä°statistikleri gÃ¼ncelle
            document.getElementById('trend-total-themes').textContent = totalThemes.toLocaleString();
            document.getElementById('trend-artan-count').textContent = artanCount.toLocaleString();
            document.getElementById('trend-azalan-count').textContent = azalanCount.toLocaleString();
            document.getElementById('trend-stabil-count').textContent = stabilCount.toLocaleString();
            
            // SÄ±ralama
            filtered.sort((a, b) => {
                let aVal = a[trendSortColumn];
                let bVal = b[trendSortColumn];
                
                if (trendSortColumn === 'trend_slope' || trendSortColumn === 'avg_docs' || trendSortColumn === 'std_docs') {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                }
                
                if (trendSortAsc) {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
            
            // Ä°lk 100 satÄ±rÄ± gÃ¶ster
            const toShow = filtered.slice(0, 100);
            
            tbody.innerHTML = '';
            toShow.forEach(row => {
                const trendCategory = row.trend_category || 'Stabil';
                let trendColor = '#FF9800'; // Stabil
                if (trendCategory === 'Artan') trendColor = '#4CAF50';
                else if (trendCategory === 'Azalan') trendColor = '#f44336';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${row.country}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace; font-weight: 600;">${row.theme_code}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center; font-weight: 600; color: ${trendColor};">${parseFloat(row.trend_slope).toFixed(2)}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                        <span style="background: ${trendColor}20; color: ${trendColor}; padding: 4px 8px; border-radius: 4px; font-weight: 600;">${trendCategory}</span>
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; font-weight: 600;">${parseFloat(row.avg_docs).toFixed(0)}</td>
                `;
                tbody.appendChild(tr);
            });
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #999;">Filtreye uygun veri bulunamadÄ±</td></tr>';
            } else if (filtered.length > 100) {
                const infoRow = document.createElement('tr');
                infoRow.innerHTML = `<td colspan="5" style="text-align: center; padding: 15px; background: #fff3e0; color: #FF5722;">
                    âš ï¸ ${filtered.length.toLocaleString()} kayÄ±ttan ilk 100 gÃ¶steriliyor. Filtreleri daraltarak daha fazla sonuÃ§ gÃ¶rebilirsiniz.
                </td>`;
                tbody.appendChild(infoRow);
            }
        }
        
        // Trend tablosu sÄ±ralama
        function sortTrendTable(column) {
            if (trendSortColumn === column) {
                trendSortAsc = !trendSortAsc;
            } else {
                trendSortColumn = column;
                trendSortAsc = column === 'trend_slope' ? false : true;  // trend_slope iÃ§in varsayÄ±lan desc
            }
            updateTrendAnalysisTable();
        }
        
        // ==================== TABLO-4 SONU ====================
        
        // Tema analizi yap - IPTC kategorileriyle entegre
        function analyzeThemes() {
            if (!gdeltDataLoaded) {
                showGDELTStatus('âŒ Ã–nce CSV verilerini yÃ¼kleyin!', 'error');
                return;
            }
            
            showGDELTStatus('ğŸ” Tema analizi yapÄ±lÄ±yor...', 'info');
            
            const countries = ['CE', 'HO', 'HR', 'KG', 'LO', 'SA'];
            const themeCountByCountry = {};
            
            // Her tema iÃ§in hangi Ã¼lkelerde var ve toplam docs?
            gdeltTotalDocs.forEach(row => {
                if (!themeCountByCountry[row.theme_code]) {
                    themeCountByCountry[row.theme_code] = { 
                        countries: new Set(), 
                        totalDocs: 0,
                        byCountry: {}
                    };
                }
                themeCountByCountry[row.theme_code].countries.add(row.country);
                themeCountByCountry[row.theme_code].totalDocs += row.total_docs;
                themeCountByCountry[row.theme_code].byCountry[row.country] = row.total_docs;
            });
            
            // TÃœM temalarÄ± IPTC kategorilerine grupla (6 Ã¼lke filtresi KALDIRILDI)
            const themesByIPTC = {};
            const allMappedThemes = [];
            
            // Ã–nce kÃ¼meleme sonuÃ§larÄ±ndan tÃ¼m temalarÄ± al
            if (iptcMappingResults && iptcMappingResults.themes) {
                iptcMappingResults.themes.forEach(mappedTheme => {
                    const theme = mappedTheme.theme_code;
                    const iptcCategory = mappedTheme.iptc_final_label || mappedTheme.iptc_label;
                    const themeData = themeCountByCountry[theme];
                    const totalDocs = themeData ? themeData.totalDocs : 0;
                    
                    if (iptcCategory && iptcCategory !== 'DiÄŸer') {
                        allMappedThemes.push({
                            theme,
                            totalDocs,
                            iptcCategory,
                            countryCount: themeData ? themeData.countries.size : 0,
                            byCountry: themeData ? themeData.byCountry : {}
                        });
                        
                        if (!themesByIPTC[iptcCategory]) {
                            themesByIPTC[iptcCategory] = [];
                        }
                        themesByIPTC[iptcCategory].push({ theme, totalDocs: totalDocs || 0 });
                    }
                });
            }
            
            // KÃ¼meleme yapÄ±lmamÄ±ÅŸsa CSV'den statik eÅŸleÅŸtirme yap
            if (allMappedThemes.length === 0) {
                for (const [theme, data] of Object.entries(themeCountByCountry)) {
                    const isMetadata = METADATA_PREFIXES.some(p => theme.startsWith(p));
                    if (isMetadata) continue;
                    
                    const iptcCategory = getIPTCCategory(theme);
                    if (iptcCategory) {
                        allMappedThemes.push({
                            theme,
                            totalDocs: data.totalDocs,
                            iptcCategory,
                            countryCount: data.countries.size,
                            byCountry: data.byCountry
                        });
                        
                        if (!themesByIPTC[iptcCategory]) {
                            themesByIPTC[iptcCategory] = [];
                        }
                        themesByIPTC[iptcCategory].push({ theme, totalDocs: data.totalDocs });
                    }
                }
            }
            
            // 6 Ã¼lkede ortak olanlarÄ± ayrÄ± say (istatistik iÃ§in)
            const commonThemes = allMappedThemes.filter(t => t.countryCount === 6);
            
            // Toplam docs'a gÃ¶re sÄ±rala
            allMappedThemes.sort((a, b) => b.totalDocs - a.totalDocs);
            
            // IPTC kategorilerine gÃ¶re sÄ±rala (tema sayÄ±sÄ±na gÃ¶re)
            const sortedIPTCCategories = Object.entries(themesByIPTC)
                .sort((a, b) => b[1].length - a[1].length);
            
            // IPTC renk haritasÄ±
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'society': '#607D8B',
                'crime, law and justice': '#3F51B5',
                'science and technology': '#009688',
                'labour': '#FFC107',
                'lifestyle and leisure': '#00BCD4',
                'religion': '#795548',
                'human interest': '#FF5722',
                'sport': '#CDDC39',
                'arts, culture, entertainment and media': '#673AB7',
                'weather': '#03A9F4',
                'DiÄŸer': '#9E9E9E'
            };
            
            const totalMapped = allMappedThemes.length;
            const categoriesFound = sortedIPTCCategories.length;
            showGDELTStatus(`âœ… Analiz tamamlandÄ±! ${totalMapped} tema eÅŸleÅŸtirildi (${commonThemes.length} tanesi 6 Ã¼lkede ortak), ${categoriesFound} IPTC kategorisinde.`, 'success');
            
            // Global'e kaydet (matris iÃ§in)
            window.analyzedIPTCCategories = sortedIPTCCategories;
            window.analyzedCommonThemes = commonThemes;
            window.allMappedThemes = allMappedThemes;
            window.themesByIPTC = themesByIPTC;
            window.themeCountByCountry = themeCountByCountry;
            
            // AdÄ±m A: IPTC Kategori Ã–zet KartlarÄ±nÄ± oluÅŸtur
            renderIPTCSummaryCards(sortedIPTCCategories, allMappedThemes, iptcColors);
            
            // AdÄ±m B: Matrisi otomatik oluÅŸtur
            setTimeout(() => generateCountryThemeMatrix(), 100);
            
            // AdÄ±m C: SeÃ§im panelini oluÅŸtur
            renderIPTCSelectionPanel(sortedIPTCCategories, allMappedThemes, iptcColors);
        }
        
        // AdÄ±m A: IPTC Kategori Ã–zet KartlarÄ±
        function renderIPTCSummaryCards(sortedIPTCCategories, allMappedThemes, iptcColors) {
            const grid = document.getElementById('iptc-summary-cards-grid');
            if (!grid) return;
            
            const countries = ['CE', 'HO', 'HR', 'KG', 'LO', 'SA'];
            const allIPTCCategories = Object.keys(IPTC_CATEGORIES);
            
            // Tablo 3'ten (gdeltMonthlyDetail) IPTC kategorilerine gÃ¶re toplam dokÃ¼man hesapla
            const docsByIPTCFromMonthly = {};
            const themesByIPTCFromMonthly = {};
            const monthsByIPTCFromMonthly = {};
            
            if (gdeltMonthlyDetail && gdeltMonthlyDetail.length > 0) {
                // Ã–nce tema â†’ IPTC mapping oluÅŸtur
                const themeToIPTC = {};
                if (iptcMappingResults && iptcMappingResults.themes) {
                    iptcMappingResults.themes.forEach(mappedTheme => {
                        const themeCode = mappedTheme.theme_code;
                        const iptcCat = mappedTheme.iptc_final_label || mappedTheme.iptc_label;
                        if (iptcCat && iptcCat !== 'DiÄŸer') {
                            themeToIPTC[themeCode] = iptcCat;
                        }
                    });
                } else {
                    // Fallback: statik mapping kullan
                    gdeltMonthlyDetail.forEach(row => {
                        const iptcCat = getIPTCCategory(row.theme_code);
                        if (iptcCat) {
                            themeToIPTC[row.theme_code] = iptcCat;
                        }
                    });
                }
                
                // Tablo 3'Ã¼ tara ve IPTC kategorilerine gÃ¶re topla
                gdeltMonthlyDetail.forEach(row => {
                    const iptcCat = themeToIPTC[row.theme_code];
                    if (iptcCat) {
                        if (!docsByIPTCFromMonthly[iptcCat]) {
                            docsByIPTCFromMonthly[iptcCat] = 0;
                            themesByIPTCFromMonthly[iptcCat] = new Set();
                            monthsByIPTCFromMonthly[iptcCat] = new Set();
                        }
                        docsByIPTCFromMonthly[iptcCat] += row.n_docs || 0;
                        themesByIPTCFromMonthly[iptcCat].add(row.theme_code);
                        monthsByIPTCFromMonthly[iptcCat].add(row.ym);
                    }
                });
            }
            
            // Hangi veri kaynaÄŸÄ±nÄ± kullanacaÄŸÄ±z?
            const useMonthlyData = Object.keys(docsByIPTCFromMonthly).length > 0;
            const docsByIPTC = useMonthlyData ? docsByIPTCFromMonthly : {};
            const themesByIPTC = useMonthlyData ? themesByIPTCFromMonthly : {};
            const monthsByIPTC = useMonthlyData ? monthsByIPTCFromMonthly : {};
            
            // Her kategori iÃ§in istatistikleri hesapla
            const categoryStats = {};
            allIPTCCategories.forEach(cat => {
                // IPTC kategorisindeki toplam dokÃ¼man (Tablo 3'ten)
                const totalDocs = docsByIPTC[cat] || 0;
                const themeCount = themesByIPTC[cat] ? themesByIPTC[cat].size : 0;
                const monthsCount = monthsByIPTC[cat] ? monthsByIPTC[cat].size : 36; // Default 36 ay (2022-2024)
                
                // AylÄ±k ortalama dokÃ¼man hesapla
                const avgMonthlyDocs = monthsCount > 0 ? Math.round(totalDocs / monthsCount) : 0;
                
                // 6 Ã¼lkede kapsama oranÄ± hesapla (mevcut mantÄ±k)
                let coverageSum = 0;
                let coverageCount = 0;
                
                const themesToCheck = themesByIPTC[cat] ? Array.from(themesByIPTC[cat]) : [];
                
                themesToCheck.forEach(themeCode => {
                    countries.forEach(country => {
                        const qualityRow = gdeltMonthlyQuality.find(
                            r => r.country === country && r.theme_code === themeCode
                        );
                        if (qualityRow && qualityRow.months_total > 0) {
                            coverageSum += qualityRow.months_ok / qualityRow.months_total;
                            coverageCount++;
                        }
                    });
                });
                
                const avgCoverage = coverageCount > 0 ? (coverageSum / coverageCount * 100).toFixed(0) : 0;
                
                categoryStats[cat] = {
                    themeCount: themeCount,
                    totalDocs: totalDocs,
                    avgMonthlyDocs: avgMonthlyDocs,
                    monthsCount: monthsCount,
                    avgCoverage: avgCoverage,
                    themes: themesToCheck
                };
            });
            
            // KartlarÄ± oluÅŸtur
            let cardsHtml = '';
            const iptcEmojis = {
                'economy, business and finance': 'ğŸ’°',
                'conflict, war and peace': 'âš”ï¸',
                'politics and government': 'ğŸ›ï¸',
                'health': 'ğŸ¥',
                'education': 'ğŸ“š',
                'disaster, accident and emergency incident': 'ğŸš¨',
                'environment': 'ğŸŒ',
                'society': 'ğŸ‘¥',
                'crime, law and justice': 'ğŸ‘®',
                'science and technology': 'ğŸ”¬',
                'labour': 'ğŸ’¼',
                'lifestyle and leisure': 'âœˆï¸',
                'religion': 'ğŸ•Œ',
                'human interest': 'â¤ï¸',
                'sport': 'âš½',
                'arts, culture, entertainment and media': 'ğŸ¨',
                'weather': 'ğŸŒ¤ï¸'
            };
            
            // Tema sayÄ±sÄ±na gÃ¶re sÄ±rala
            const sortedCats = Object.entries(categoryStats).sort((a, b) => b[1].themeCount - a[1].themeCount);
            
            sortedCats.forEach(([cat, stats]) => {
                const color = iptcColors[cat] || '#667eea';
                const emoji = iptcEmojis[cat] || 'ğŸ“Œ';
                const shortLabel = cat.split(',')[0];
                const hasData = stats.themeCount > 0;
                
                // DokÃ¼man sayÄ±sÄ±nÄ± formatla (6 Ã¼lke toplamÄ±)
                let docsFormatted = '-';
                if (stats.totalDocs > 1000000) {
                    docsFormatted = (stats.totalDocs / 1000000).toFixed(1) + 'M';
                } else if (stats.totalDocs > 1000) {
                    docsFormatted = (stats.totalDocs / 1000).toFixed(0) + 'K';
                } else if (stats.totalDocs > 0) {
                    docsFormatted = stats.totalDocs.toString();
                }
                
                // AylÄ±k ortalama iÃ§in tooltip metni
                const tooltipText = hasData ? 
                    `AylÄ±k ortalama: ${stats.avgMonthlyDocs.toLocaleString()} dokÃ¼man (${stats.totalDocs.toLocaleString()} toplam / ${stats.monthsCount} ay)` : 
                    'Veri yok';
                
                // Kapsama badge rengi
                let coverageBadge = '';
                if (hasData) {
                    const cov = parseInt(stats.avgCoverage);
                    if (cov >= 70) {
                        coverageBadge = `<span style="background: #4CAF50; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em;">âœ“ ${cov}%</span>`;
                    } else if (cov >= 40) {
                        coverageBadge = `<span style="background: #FF9800; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em;">âš  ${cov}%</span>`;
                    } else {
                        coverageBadge = `<span style="background: #f44336; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em;">âœ– ${cov}%</span>`;
                    }
                }
                
                cardsHtml += `
                    <div class="iptc-card" style="background: white; border-left: 5px solid ${color}; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; opacity: ${hasData ? 1 : 0.5};" title="${tooltipText}">
                        <div style="background: ${color}15; padding: 10px 12px; border-bottom: 1px solid ${color}30;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 600; color: ${color}; text-transform: capitalize; font-size: 0.95em;">${emoji} ${shortLabel}</span>
                                ${coverageBadge}
                            </div>
                        </div>
                        <div style="padding: 12px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                                <div style="text-align: center; background: #f8f9fa; padding: 8px; border-radius: 4px;">
                                    <div style="font-size: 1.3em; font-weight: bold; color: ${color};">${stats.themeCount}</div>
                                    <div style="font-size: 0.7em; color: #666;">Tema</div>
                                </div>
                                <div style="text-align: center; background: #f8f9fa; padding: 8px; border-radius: 4px;">
                                    <div style="font-size: 1.3em; font-weight: bold; color: #333;">${docsFormatted}</div>
                                    <div style="font-size: 0.7em; color: #666;">DokÃ¼man</div>
                                </div>
                            </div>
                            ${hasData ? `<div style="font-size: 0.75em; color: #666;">6 Ã¼lkede kapsama: ${stats.avgCoverage}%</div>` : '<div style="font-size: 0.75em; color: #999;">Veri yok</div>'}
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = cardsHtml;
        }
        
        // AdÄ±m C: IPTC SeÃ§im Paneli
        let selectedIPTCCategories = new Set();
        let categoryCountryChart = null;
        
        function renderIPTCSelectionPanel(sortedIPTCCategories, allMappedThemes, iptcColors) {
            const listEl = document.getElementById('iptc-selection-list');
            if (!listEl) return;
            
            const allIPTCCategories = Object.keys(IPTC_CATEGORIES);
            const iptcEmojis = {
                'economy, business and finance': 'ğŸ’°',
                'conflict, war and peace': 'âš”ï¸',
                'politics and government': 'ğŸ›ï¸',
                'health': 'ğŸ¥',
                'education': 'ğŸ“š',
                'disaster, accident and emergency incident': 'ğŸš¨',
                'environment': 'ğŸŒ',
                'society': 'ğŸ‘¥',
                'crime, law and justice': 'ğŸ‘®',
                'science and technology': 'ğŸ”¬',
                'labour': 'ğŸ’¼',
                'lifestyle and leisure': 'âœˆï¸',
                'religion': 'ğŸ•Œ',
                'human interest': 'â¤ï¸',
                'sport': 'âš½',
                'arts, culture, entertainment and media': 'ğŸ¨',
                'weather': 'ğŸŒ¤ï¸'
            };
            
            let html = '';
            
            // Tema sayÄ±sÄ±na gÃ¶re sÄ±rala
            const categoryStats = {};
            allIPTCCategories.forEach(cat => {
                const themesInCat = sortedIPTCCategories.find(([c, _]) => c === cat);
                const themes = themesInCat ? themesInCat[1] : [];
                const totalDocs = themes.reduce((sum, t) => sum + t.totalDocs, 0);
                
                // Kalite kontrolÃ¼ yap
                let avgQuality = 0;
                let qualityCount = 0;
                themes.forEach(t => {
                    ['CE', 'HO', 'HR', 'KG', 'LO', 'SA'].forEach(country => {
                        const qRow = gdeltMonthlyQuality.find(r => r.country === country && r.theme_code === t.theme);
                        if (qRow && qRow.months_total > 0) {
                            avgQuality += qRow.months_ok / qRow.months_total;
                            qualityCount++;
                        }
                    });
                });
                avgQuality = qualityCount > 0 ? (avgQuality / qualityCount * 100) : 0;
                
                categoryStats[cat] = { themes, totalDocs, avgQuality, themeCount: themes.length };
            });
            
            const sortedCats = Object.entries(categoryStats).sort((a, b) => b[1].themeCount - a[1].themeCount);
            
            sortedCats.forEach(([cat, stats]) => {
                const color = iptcColors[cat] || '#667eea';
                const emoji = iptcEmojis[cat] || 'ğŸ“Œ';
                const shortLabel = cat.split(',')[0];
                const hasData = stats.themeCount > 0;
                const isRecommended = stats.avgQuality >= 70 && stats.themeCount >= 5;
                
                // DokÃ¼man formatla
                let docsStr = '-';
                if (stats.totalDocs > 1000000) docsStr = (stats.totalDocs / 1000000).toFixed(1) + 'M';
                else if (stats.totalDocs > 1000) docsStr = (stats.totalDocs / 1000).toFixed(0) + 'K';
                else if (stats.totalDocs > 0) docsStr = stats.totalDocs.toString();
                
                html += `
                    <label class="iptc-select-row" style="display: flex; align-items: center; padding: 8px 10px; margin-bottom: 4px; background: ${hasData ? (isRecommended ? '#e8f5e9' : 'white') : '#f5f5f5'}; border: 1px solid ${hasData ? (isRecommended ? '#4CAF50' : '#e0e0e0') : '#ccc'}; border-radius: 6px; cursor: ${hasData ? 'pointer' : 'not-allowed'}; opacity: ${hasData ? 1 : 0.5};">
                        <input type="checkbox" value="${cat}" onchange="updateCategorySelection()" ${hasData ? '' : 'disabled'} style="margin-right: 10px; width: 18px; height: 18px;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span style="color: ${color}; font-weight: 600;">${emoji}</span>
                                <span style="font-size: 0.9em; color: #333; text-transform: capitalize;">${shortLabel}</span>
                                ${isRecommended ? '<span style="background: #4CAF50; color: white; padding: 1px 5px; border-radius: 8px; font-size: 0.65em;">Ã–nerilen</span>' : ''}
                            </div>
                            <div style="font-size: 0.75em; color: #666; margin-top: 2px;">
                                ${stats.themeCount} tema Â· ${docsStr} dokÃ¼man
                            </div>
                        </div>
                    </label>
                `;
            });
            
            listEl.innerHTML = html;
            
            // SayacÄ± gÃ¼ncelle
            updateCategorySelectionCount();
        }
        
        function updateCategorySelection() {
            const checkboxes = document.querySelectorAll('#iptc-selection-list input[type="checkbox"]:checked');
            selectedIPTCCategories = new Set();
            checkboxes.forEach(cb => selectedIPTCCategories.add(cb.value));
            
            updateCategorySelectionCount();
            updateSelectedCategoriesSummary();
            updateCategoryCountryChart();
            updateV1V2ComparisonTable();
        }
        
        function updateCategorySelectionCount() {
            const countEl = document.getElementById('selected-category-count');
            if (countEl) {
                countEl.textContent = `${selectedIPTCCategories.size} / 17`;
                countEl.style.background = selectedIPTCCategories.size >= 5 ? '#4CAF50' : '#2196F3';
            }
        }
        
        function selectRecommendedCategories() {
            const checkboxes = document.querySelectorAll('#iptc-selection-list input[type="checkbox"]');
            checkboxes.forEach(cb => {
                const row = cb.closest('.iptc-select-row');
                if (row && row.querySelector('span[style*="#4CAF50"]')) {
                    cb.checked = true;
                }
            });
            updateCategorySelection();
        }
        
        function clearCategorySelection() {
            const checkboxes = document.querySelectorAll('#iptc-selection-list input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            selectedIPTCCategories.clear();
            updateCategorySelectionCount();
            updateSelectedCategoriesSummary();
            updateCategoryCountryChart();
            updateV1V2ComparisonTable();
        }
        
        function updateSelectedCategoriesSummary() {
            const summaryEl = document.getElementById('selected-categories-summary');
            if (!summaryEl) return;
            
            if (selectedIPTCCategories.size === 0) {
                summaryEl.innerHTML = '<div style="text-align: center; color: #999; padding: 20px; grid-column: 1/-1;">Kategori seÃ§in...</div>';
                return;
            }
            
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'society': '#607D8B',
                'crime, law and justice': '#3F51B5',
                'science and technology': '#009688',
                'labour': '#FFC107',
                'lifestyle and leisure': '#00BCD4',
                'religion': '#795548',
                'human interest': '#FF5722',
                'sport': '#CDDC39',
                'arts, culture, entertainment and media': '#673AB7',
                'weather': '#03A9F4'
            };
            
            let html = '';
            let totalThemes = 0;
            let totalDocs = 0;
            
            selectedIPTCCategories.forEach(cat => {
                const color = iptcColors[cat] || '#667eea';
                const catData = (window.analyzedIPTCCategories || []).find(([c, _]) => c === cat);
                const themes = catData ? catData[1] : [];
                const docs = themes.reduce((sum, t) => sum + t.totalDocs, 0);
                totalThemes += themes.length;
                totalDocs += docs;
                
                html += `
                    <div style="background: ${color}15; border-left: 3px solid ${color}; padding: 8px; border-radius: 4px;">
                        <div style="font-size: 0.8em; color: ${color}; font-weight: 600; text-transform: capitalize;">${cat.split(',')[0]}</div>
                        <div style="font-size: 0.75em; color: #666;">${themes.length} tema</div>
                    </div>
                `;
            });
            
            // Toplam Ã¶zet
            html += `
                <div style="background: #e3f2fd; border-left: 3px solid #1976D2; padding: 8px; border-radius: 4px;">
                    <div style="font-size: 0.8em; color: #1976D2; font-weight: 600;">TOPLAM</div>
                    <div style="font-size: 0.75em; color: #666;">${totalThemes} tema Â· ${(totalDocs/1000000).toFixed(1)}M dok</div>
                </div>
            `;
            
            summaryEl.innerHTML = html;
        }
        
        function updateCategoryCountryChart() {
            const canvas = document.getElementById('category-country-bar-chart');
            if (!canvas) return;
            
            if (categoryCountryChart) {
                categoryCountryChart.destroy();
            }
            
            if (selectedIPTCCategories.size === 0) {
                return;
            }
            
            const countries = ['CE', 'HO', 'HR', 'KG', 'LO', 'SA'];
            const countryNames = { CE: 'Sri Lanka', HO: 'Honduras', HR: 'Croatia', KG: 'Kyrgyzstan', LO: 'Slovakia', SA: 'Saudi Arabia' };
            
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'society': '#607D8B',
                'crime, law and justice': '#3F51B5',
                'science and technology': '#009688',
                'labour': '#FFC107',
                'lifestyle and leisure': '#00BCD4',
                'religion': '#795548',
                'human interest': '#FF5722',
                'sport': '#CDDC39',
                'arts, culture, entertainment and media': '#673AB7',
                'weather': '#03A9F4'
            };
            
            const datasets = [];
            
            selectedIPTCCategories.forEach(cat => {
                const color = iptcColors[cat] || '#667eea';
                const catData = (window.analyzedIPTCCategories || []).find(([c, _]) => c === cat);
                const themes = catData ? catData[1] : [];
                
                const data = countries.map(country => {
                    let countryDocs = 0;
                    themes.forEach(t => {
                        const themeData = window.themeCountByCountry ? window.themeCountByCountry[t.theme] : null;
                        if (themeData && themeData.byCountry && themeData.byCountry[country]) {
                            countryDocs += themeData.byCountry[country];
                        }
                    });
                    return countryDocs / 1000000; // Milyon olarak
                });
                
                datasets.push({
                    label: cat.split(',')[0],
                    data: data,
                    backgroundColor: color + 'CC',
                    borderColor: color,
                    borderWidth: 1
                });
            });
            
            categoryCountryChart = new Chart(canvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: countries.map(c => countryNames[c]),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10 } } },
                        title: { display: false }
                    },
                    scales: {
                        x: { stacked: false },
                        y: { 
                            stacked: false, 
                            title: { display: true, text: 'DokÃ¼man (Milyon)' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function updateV1V2ComparisonTable() {
            const tbody = document.getElementById('v1-v2-tbody');
            if (!tbody) return;
            
            if (selectedIPTCCategories.size === 0 || !iptcMappingResultsV1 || !iptcMappingResultsV2) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 15px; color: #999;">Kategori seÃ§in ve V1/V2 sonuÃ§larÄ±nÄ± yÃ¼kleyin</td></tr>';
                return;
            }
            
            let html = '';
            
            selectedIPTCCategories.forEach(cat => {
                const v1Themes = iptcMappingResultsV1.themes ? iptcMappingResultsV1.themes.filter(t => (t.iptc_final_label || t.iptc_label) === cat).length : 0;
                const v2Themes = iptcMappingResultsV2.themes ? iptcMappingResultsV2.themes.filter(t => (t.iptc_final_label || t.iptc_label) === cat).length : 0;
                const diff = v2Themes - v1Themes;
                const diffColor = diff > 0 ? '#4CAF50' : (diff < 0 ? '#f44336' : '#999');
                const diffSign = diff > 0 ? '+' : '';
                
                html += `
                    <tr style="border-bottom: 1px solid #ffe0b2;">
                        <td style="padding: 6px 8px; text-align: left; text-transform: capitalize; font-size: 0.85em;">${cat.split(',')[0]}</td>
                        <td style="padding: 6px 8px; text-align: center;">${v1Themes}</td>
                        <td style="padding: 6px 8px; text-align: center;">${v2Themes}</td>
                        <td style="padding: 6px 8px; text-align: center; color: ${diffColor}; font-weight: 600;">${diffSign}${diff}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        function exportSelectedCategoriesAnalysis() {
            if (selectedIPTCCategories.size === 0) {
                alert('Ã–nce kategori seÃ§in!');
                return;
            }
            
            // CSV oluÅŸtur
            let csv = 'Kategori,Tema Kodu,Ãœlke,Toplam DokÃ¼man,Kalite OranÄ±\n';
            
            selectedIPTCCategories.forEach(cat => {
                const catData = (window.analyzedIPTCCategories || []).find(([c, _]) => c === cat);
                const themes = catData ? catData[1] : [];
                
                themes.forEach(t => {
                    const themeData = window.themeCountByCountry ? window.themeCountByCountry[t.theme] : null;
                    if (themeData) {
                        Object.entries(themeData.byCountry || {}).forEach(([country, docs]) => {
                            const qRow = gdeltMonthlyQuality.find(r => r.country === country && r.theme_code === t.theme);
                            const quality = qRow && qRow.months_total > 0 ? (qRow.months_ok / qRow.months_total * 100).toFixed(1) : '0';
                            csv += `"${cat}","${t.theme}","${country}",${docs},${quality}\n`;
                        });
                    }
                });
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `selected_categories_analysis_${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
        }
        
        // Veri kalitesi ve istatistik panelini gÃ¼ncelle (eski fonksiyon - geriye uyumluluk)
        function updateDataQualityStats(sortedCategories, commonThemes, allMappedThemes) {
            // Bu fonksiyon artÄ±k kullanÄ±lmÄ±yor, AdÄ±m A kartlarÄ± bunu deÄŸiÅŸtirdi
            // Geriye uyumluluk iÃ§in boÅŸ bÄ±rakÄ±ldÄ±
            console.log('Stats gÃ¼ncellendi:', {
                totalThemes: allMappedThemes?.length || 0,
                commonThemes: commonThemes?.length || 0,
                categories: sortedCategories?.length || 0
            });
        }
        
        // Ãœlke-Kategori matrisi oluÅŸtur - IPTC ve 3 tablo entegrasyonu
        function generateCountryThemeMatrix() {
            if (!gdeltDataLoaded) {
                showGDELTStatus('âŒ Ã–nce CSV verilerini yÃ¼kleyin!', 'error');
                return;
            }
            
            // Ã–nce tema analizi yapÄ±lmÄ±ÅŸ mÄ± kontrol et
            if (!window.analyzedIPTCCategories || window.analyzedIPTCCategories.length === 0) {
                showGDELTStatus('âš ï¸ Ã–nce "Tema Analizi Yap" butonuna tÄ±klayÄ±n!', 'info');
                analyzeThemes();
            }
            
            showGDELTStatus('ğŸ“Š Matris oluÅŸturuluyor...', 'info');
            
            const countries = ['CE', 'HO', 'HR', 'KG', 'LO', 'SA'];
            
            // En Ã§ok tema iÃ§eren tÃ¼m IPTC kategorilerini al (17 kategori)
            const allIPTCCategories = Object.keys(IPTC_CATEGORIES);
            const categoriesWithData = (window.analyzedIPTCCategories || []);
            
            // TÃ¼m 17 kategoriyi birleÅŸtir (veri olanlar Ã¶nce, olmayanlar sonra)
            const topCategories = [];
            
            // Ã–nce veri olan kategorileri ekle
            categoriesWithData.forEach(([cat, themes]) => {
                topCategories.push([cat, themes]);
            });
            
            // Sonra veri olmayan kategorileri ekle
            allIPTCCategories.forEach(cat => {
                if (!topCategories.find(([c, _]) => c === cat)) {
                    topCategories.push([cat, []]);
                }
            });
            
            if (topCategories.length === 0) {
                showGDELTStatus('âŒ IPTC kategorileri bulunamadÄ±!', 'error');
                return;
            }
            
            // IPTC renk haritasÄ±
            const iptcColors = {
                'economy, business and finance': '#FF9800',
                'conflict, war and peace': '#F44336',
                'politics and government': '#2196F3',
                'health': '#4CAF50',
                'education': '#9C27B0',
                'disaster, accident and emergency incident': '#E91E63',
                'environment': '#8BC34A',
                'society': '#607D8B',
                'crime, law and justice': '#3F51B5',
                'science and technology': '#009688',
                'labour': '#FFC107',
                'lifestyle and leisure': '#00BCD4',
                'religion': '#795548',
                'human interest': '#FF5722',
                'sport': '#CDDC39',
                'arts, culture, entertainment and media': '#673AB7',
                'weather': '#03A9F4'
            };
            
            // Matris tablosu baÅŸlÄ±klarÄ±nÄ± gÃ¼ncelle (17 kategori iÃ§in kompakt baÅŸlÄ±klar)
            const thead = document.querySelector('#country-theme-matrix thead tr');
            thead.innerHTML = '<th style="padding: 6px 8px; position: sticky; left: 0; background: #E91E63; z-index: 1; white-space: nowrap;">Ãœlke</th>' + 
                topCategories.map(([cat, themes]) => {
                    const shortLabel = cat.split(',')[0].substring(0, 12);
                    const color = iptcColors[cat] || '#667eea';
                    const hasData = themes.length > 0;
                    return `<th style="padding: 6px 4px; font-size: 0.7em; text-transform: capitalize; background: ${hasData ? color : '#9e9e9e'}; white-space: nowrap; writing-mode: vertical-lr; text-orientation: mixed; height: 100px; opacity: ${hasData ? 1 : 0.5};" title="${cat}">${shortLabel}</th>`;
                }).join('');
            
            // Her Ã¼lke-kategori iÃ§in kalite hesapla (Tablo-2 ve Tablo-3'ten)
            const matrix = {};
            
            countries.forEach(country => {
                matrix[country] = {};
                
                topCategories.forEach(([catName, themes]) => {
                    // Bu kategorideki temalarÄ±n kalitesini kontrol et
                    let totalMonthsOk = 0;
                    let totalMonthsTotal = 0;
                    let totalDocs = 0;
                    let themesWithData = 0;
                    
                    themes.forEach(themeInfo => {
                        // Tablo-2'den kalite verisi
                        const qualityRow = gdeltMonthlyQuality.find(
                            r => r.country === country && r.theme_code === themeInfo.theme
                        );
                        
                        if (qualityRow) {
                            totalMonthsOk += qualityRow.months_ok;
                            totalMonthsTotal += qualityRow.months_total;
                            themesWithData++;
                        }
                        
                        // Tablo-1'den toplam docs
                        const docsRow = gdeltTotalDocs.find(
                            r => r.country === country && r.theme_code === themeInfo.theme
                        );
                        if (docsRow) {
                            totalDocs += docsRow.total_docs;
                        }
                    });
                    
                    // Ortalama ratio hesapla
                    const ratio = totalMonthsTotal > 0 ? totalMonthsOk / totalMonthsTotal : 0;
                    const noData = themes.length === 0;
                    
                    let decision = noData ? '-' : 'âœ–';
                    let color = noData ? '#999' : '#f44336';
                    let bgColor = noData ? '#f5f5f5' : '#ffebee';
                    
                    if (!noData) {
                        if (ratio >= 0.7) {
                            decision = 'âœ”';
                            color = '#4CAF50';
                            bgColor = '#e8f5e9';
                        } else if (ratio >= 0.4) {
                            decision = 'âš ';
                            color = '#FF9800';
                            bgColor = '#fff3e0';
                        }
                    }
                    
                    matrix[country][catName] = { 
                        ratio, 
                        decision, 
                        color, 
                        bgColor,
                        totalDocs,
                        themesWithData,
                        totalThemes: themes.length,
                        noData
                    };
                });
            });
            
            // Tabloyu render et
            const tbody = document.getElementById('matrix-tbody');
            tbody.innerHTML = '';
            
            // Ãœlke isim haritasÄ±
            const countryNames = {
                'CE': 'ğŸ‡±ğŸ‡° Sri Lanka',
                'HO': 'ğŸ‡­ğŸ‡³ Honduras',
                'HR': 'ğŸ‡­ğŸ‡· Croatia',
                'KG': 'ğŸ‡°ğŸ‡¬ Kyrgyzstan',
                'LO': 'ğŸ‡¸ğŸ‡° Slovakia',
                'SA': 'ğŸ‡¸ğŸ‡¦ Saudi Arabia'
            };
            
            countries.forEach(country => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding: 6px 8px; font-weight: 600; border-bottom: 1px solid #eee; white-space: nowrap; position: sticky; left: 0; background: white; z-index: 1;">${countryNames[country] || country}</td>
                    ${topCategories.map(([cat, _]) => {
                        const cell = matrix[country][cat];
                        const tooltip = cell.noData ? 'Veri yok' : `${(cell.ratio * 100).toFixed(0)}% kalite\n${cell.themesWithData}/${cell.totalThemes} tema veri var\n${(cell.totalDocs/1000).toFixed(0)}K docs`;
                        return `
                            <td style="padding: 4px; text-align: center; border-bottom: 1px solid #eee; background: ${cell.bgColor}; cursor: ${cell.noData ? 'default' : 'help'}; opacity: ${cell.noData ? 0.4 : 1};" title="${tooltip}">
                                <span style="color: ${cell.color}; font-weight: 600; font-size: 1.1em;">${cell.decision}</span>
                                ${!cell.noData ? `<div style="font-size: 0.65em; color: #666;">${(cell.ratio * 100).toFixed(0)}%</div>` : ''}
                            </td>
                        `;
                    }).join('')}
                `;
                tbody.appendChild(tr);
            });
            
            // Ã–zet satÄ±rÄ± ekle
            const summaryRow = document.createElement('tr');
            summaryRow.style.background = '#f5f5f5';
            summaryRow.innerHTML = `
                <td style="padding: 12px; font-weight: 600; border-top: 2px solid #9C27B0;">KullanÄ±labilir</td>
                ${topCategories.map(([cat, _]) => {
                    const usableCount = countries.filter(c => matrix[c][cat].ratio >= 0.4).length;
                    const color = usableCount >= 5 ? '#4CAF50' : usableCount >= 3 ? '#FF9800' : '#f44336';
                    return `<td style="padding: 12px; text-align: center; border-top: 2px solid #9C27B0; color: ${color}; font-weight: 600;">${usableCount}/6</td>`;
                }).join('')}
            `;
            tbody.appendChild(summaryRow);
            
            showGDELTStatus(`âœ… Matris oluÅŸturuldu! ${topCategories.length} IPTC kategorisi Ã— ${countries.length} Ã¼lke`, 'success');
        }
        
        // GDELT analizini CSV olarak dÄ±ÅŸa aktar
        function exportGDELTAnalysis() {
            if (!gdeltDataLoaded) {
                showGDELTStatus('âŒ Ã–nce CSV verilerini yÃ¼kleyin!', 'error');
                return;
            }
            
            // AylÄ±k kalite verilerini dÄ±ÅŸa aktar
            let csv = 'country,theme_code,theme_type,months_total,months_ok,ratio,median_docs,decision\n';
            
            gdeltMonthlyQuality.forEach(row => {
                const themeType = getThemeType(row.theme_code);
                if (themeType !== 'category') return; // Sadece kategorileri
                
                const ratio = row.months_total > 0 ? (row.months_ok / row.months_total) : 0;
                let decision = ratio >= 0.7 ? 'monthly' : (ratio >= 0.4 ? 'quarterly' : 'exclude');
                
                csv += `${row.country},${row.theme_code},${themeType},${row.months_total},${row.months_ok},${ratio.toFixed(3)},${row.median_docs},${decision}\n`;
            });
            
            // Ä°ndir
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `gdelt_theme_analysis_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
            
            showGDELTStatus('âœ… Analiz sonuÃ§larÄ± CSV olarak indirildi!', 'success');
        }
        
        // ==================== GDELT TEMA ANALÄ°ZÄ° FONKSÄ°YONLARI SONU ====================
        
        // Sayfa yÃ¼klendiÄŸinde
        window.addEventListener('DOMContentLoaded', () => {
            initTabButtons();
            initPipelineButtons();  // Pipeline seÃ§im butonlarÄ±nÄ± baÅŸlat
            initExportFilters();    // Export filtre event listener'larÄ±nÄ± baÅŸlat
            attachEventListeners();
            updateInfoBox();
            
            // Ã–nce otomatik yÃ¼kleme dene, yoksa varsayÄ±lan veriyi yÃ¼kle
            autoLoadLastAnalysis().then(() => {
                // EÄŸer veri yÃ¼klenmediyse varsayÄ±lan veriyi yÃ¼kle
                if (allData.length === 0) {
                    loadData();
                }
                // Export filtre bilgisini gÃ¼ncelle
                updateExportFilterInfo();
            });
        });
        
        // Eksik fonksiyonlarÄ± ekle (stub'lar)
        function attachEventListeners() {
            // DiÄŸer event listener'larÄ± buraya eklenebilir
            console.log('Event listeners attached');
        }
        
        function updateInfoBox() {
            // Bilgi kutusunu gÃ¼ncelle
            console.log('Info box updated');
        }
        
        function updateExportFilterInfo() {
            // Export filtre bilgisini gÃ¼ncelle
            console.log('Export filter info updated');
        }
        
        function loadData() {
            // VarsayÄ±lan veri yÃ¼kleme
            console.log('Loading default data');
        }
        
        async function loadGDELTClusteringResults() {
            // KÃ¼meleme sonuÃ§larÄ±nÄ± yÃ¼kle
            console.log('Loading GDELT clustering results');
            // Stub implementation
            return Promise.resolve();
        }
        
        // Debug: GDELT Clustering otomatik yÃ¼kleme (sayfa yÃ¼klendiÄŸinde test iÃ§in)
        document.addEventListener('DOMContentLoaded', () => {
            // Clustering sekmesine geÃ§ilirse otomatik olarak sonuÃ§larÄ± yÃ¼klemeye Ã§alÄ±ÅŸ
            const loadResultsBtn = document.getElementById('gdelt-load-results-btn');
            if (loadResultsBtn) {
                // Buton etkinleÅŸtir ve tÄ±kla
                loadResultsBtn.disabled = false;
                // Sayfa yÃ¼klendikten 2 saniye sonra otomatik yÃ¼kleme dene
                setTimeout(() => {
                    loadGDELTClusteringResults().catch(e => console.warn('Auto-load failed:', e));
                }, 2000);
            }
        });
    </script>
</body>
</html>
